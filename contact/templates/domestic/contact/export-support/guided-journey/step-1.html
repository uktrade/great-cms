{% extends 'domestic/contact/export-support/base.html' %}
{% load static %}
{% block head_title %}Export support for UK businesses{% endblock %}
{% block head_css %}
    {{ block.super }}
    <link href="{% static 'core/css/accessible-autocomplete.min.css' %}"
          rel="stylesheet"
          type="text/css">
{% endblock %}
{% block content %}
    <div class="great">
        <div class="great-container govuk-!-padding-top-4">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full great-grid-column-seven-twelfths">
                    <h1 class="govuk-heading-xl govuk-!-margin-bottom-5">Export support for UK businesses</h1>
                    <form method="post" autocomplete="off" class="great-min-height-500 ">
                        {% csrf_token %}
                        <input type="hidden" id="sector" name="sector" value="{{ session_data.sector }}" />
                        <input type="hidden" id="make_or_do_keyword" name="make_or_do_keyword" value="{{ session_data.make_or_do_keyword }}" />
                        <input type="hidden" id="exporter_type" name="exporter_type" value="{{ session_data.exporter_type }}" />

                        <div class="govuk-!-padding-6 great-bg-white">
                            <div class="govuk-!-margin-bottom-6">
                                <h2 class="govuk-label-wrapper">
                                    <label class="govuk-label govuk-label--l" for="sic_description">
                                        What does your company make or do?
                                    </label>
                                </h2>
                                <div class="govuk-hint govuk-!-margin-bottom-3">
                                    Enter a keyword to search a list of business activities
                                </div>
                                <input type="text" id="sic_description" name="sic_description" class="govuk-input great-text-input govuk-!-width-one-half" />
                                <div id="sic_description-container"></div>
                            </div>

                            <button type="submit" class="govuk-button great-min-width-250-desktop">{{ button_text }}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block body_js %}
    {{ block.super }}
    <script type="text/javascript"
            src="{% static 'javascript/accessible-autocomplete.v3.min.js' %}"></script>
    <script type="text/javascript">

    document.querySelector('#sic_description').remove();

    const data = {{ sic_sector_data | safe}}
    const sic_descriptions = data.data.map(el => el.sic_description)
    accessibleAutocomplete({
        element: document.querySelector('#sic_description-container'),
        id: 'sic_description',
        name: 'sic_description',
        source: sic_descriptions,
        autoselect: false,
        minLength: 3,
        displayMenu: 'overlay',
        defaultValue: '{{ session_data.sic_description }}',
        templates: {
            suggestion: (selectedSIC) => {
                const {sic_description, dit_sector_list_field_04} = data.data.find(el => el.sic_description === selectedSIC)
                return `<span>${sic_description}</span><br /><span>${dit_sector_list_field_04}</span>`;
            }
        },
        onConfirm: (selectedSIC) => {
            if (selectedSIC) {
                const {dit_sector_list_field_04, exporter_type='goods'} = data.data.find(el => el.sic_description === selectedSIC);

                document.querySelector('#sector').value = dit_sector_list_field_04;
                document.querySelector('#make_or_do_keyword').value = document.querySelector('#sic_description').value;
                document.querySelector('#exporter_type').value = exporter_type;
            }
        },
        placeholder: 'For example textiles',
        inputClasses: 'govuk-input great-text-input govuk-!-width-two-thirds',
        menuClasses: 'great-autocomplete-overlay'
    });
    </script>
{% endblock %}