{% extends 'domestic/base.html' %}
{% load breadcrumbs from component_tags %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load static %}
{% load add_govuk_classes url_type from content_tags %}
{% block meta_tags %}<meta name="robots" content="noindex">{% endblock %}
{% block head_title %}{{ page.page_title }}{% endblock %}
{% block meta_title %}{{ page.page_title }}{% endblock %}
{% block body_js %}
    {{ block.super }}
    <script>
        document.getElementById('filter').addEventListener('keyup', (e) => {
            const search_term = e.target.value.toLowerCase();

            document.querySelectorAll('[data-filter]').forEach(el => {
                if (!el.dataset.filter.includes(search_term)) {
                    el.style.display = 'none'
                } else {
                    el.style.display = 'block'
                    el.parentElement.parentElement.style.display = 'block'
                }
            })
        })

        document.getElementById('must_haves').addEventListener('change', (e) => {
            const is_checked = e.target.checked;

            if (is_checked) {
                document.querySelectorAll('[data-filter]').forEach(el => {
                    if (el.dataset.necessity && el.dataset.necessity.includes('must_have')) {
                        el.style.display = 'block'
                        el.parentElement.parentElement.style.display = 'block'
                    } else {
                        el.style.display = 'none'
                    }
                })
            } else {
                document.querySelectorAll('[data-filter]').forEach(el => {
                    el.style.display = 'block'
                    el.parentElement.parentElement.style.display = 'block'
                })
            }
        })

        document.getElementById('simple').addEventListener('change', (e) => {
            const is_checked = e.target.checked;

            if (is_checked) {
                document.querySelectorAll('[data-filter]').forEach(el => {
                    if (el.dataset.complexity && el.dataset.complexity.includes('simple')) {
                        el.style.display = 'block'
                        el.parentElement.parentElement.style.display = 'block'
                    } else {
                        el.style.display = 'none'
                    }
                })
            } else {
                document.querySelectorAll('[data-filter]').forEach(el => {
                    el.style.display = 'block'
                    el.parentElement.parentElement.style.display = 'block'
                })
            }
        })
    </script>
{% endblock %}
{% block content %}
    <div class="govuk-!-padding-bottom-9 great great-bg-white">
        <div class="great-container">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    {% if page.page_body %}
                        <div class="govuk-grid-row govuk-!-margin-top-5">
                            <div class="govuk-grid-column-two-thirds">
                                <div class="govuk-!-margin-bottom-5">
                                    {% if request.GET.market %}
                                        <h1 class="govuk-heading-xl govuk-!-margin-top-5 govuk-!-margin-bottom-2">Export Support</h1>
                                    {% endif %}
                                    {% if request.GET.sic %}
                                        <div class="govuk-!-margin-top-9 govuk-!-margin-bottom-9">
                                            <h2 class="govuk-heading-s">What does your company make or do?</h2>
                                            <a href="" class="govuk-link">{{ request.GET.sic }}</a>
                                            <p class="govuk-body govuk-!-margin-top-4">
                                                <em>Because you're a goods exporter, make sure you know about...</em>
                                            </p>
                                            <hr />
                                        </div>
                                    {% endif %}
                                    {% if request.GET.market %}
                                        <h2 class="govuk-heading-s">Which country are you selling to?</h2>
                                        <a href="" class="govuk-link">{{ request.GET.market }}</a>
                                        <div class="great-bg-light-blue govuk-!-padding-4 govuk-!-margin-top-8 govuk-!-margin-bottom-8">
                                            <a href="{% if task.value.goods_url %}{{ task.value.goods_url }}{% else %}{{ task.value.services_url }}{% endif %}"
                                               class="govuk-heading-s govuk-!-margin-bottom-0 great-heading-link">
                                                <h2 class="govuk-heading-s great-heading-link__heading">
                                                    <span>Exporting guide to {{ request.GET.market }}</span>
                                                </h2>
                                            </a>
                                        </div>
                                        <hr />
                                    {% endif %}
                                    {% if request.GET.market %}
                                        <h2 class="govuk-heading-s">Whats the subject of your enquiry?</h2>
                                        <a href="" class="govuk-link">{{ page.page_title }}</a>
                                    {% else %}
                                        <h1 class="govuk-heading-xl govuk-!-margin-top-5 govuk-!-margin-bottom-2">{{ page.page_title }}</h1>
                                        {% if page.page_intro %}{{ page.page_intro| richtext | add_govuk_classes }}{% endif %}
                                    {% endif %}
                                    {% if not request.GET.market %}
                                        <input class="govuk-input govuk-!-padding-5 govuk-!-margin-top-5 govuk-!-margin-bottom-2"
                                               id="filter"
                                               type="text"
                                               placeholder="Filter task list by key word" />
                                        <!-- <div class="govuk-checkboxes govuk-!-margin-bottom-3" data-module="govuk-checkboxes">
                                            <div class="govuk-checkboxes__item">
                                                <input class="govuk-checkboxes__input" id="must_haves" name="must_haves" type="checkbox">
                                                <label class="govuk-label govuk-checkboxes__label" for="must_haves">Show must have tasks</label>
                                            </div>
                                        </div>
                                        <div class="govuk-checkboxes govuk-!-margin-bottom-3" data-module="govuk-checkboxes">
                                            <div class="govuk-checkboxes__item">
                                                <input class="govuk-checkboxes__input" id="simple" name="simple" type="checkbox">
                                                <label class="govuk-label govuk-checkboxes__label" for="simple">Show simple tasks</label>
                                            </div>
                                        </div> -->
                                    {% endif %}
                                </div>
                                <div>
                                    {% for task in page.page_body %}
                                        <div id="{{ task.value.title }}"
                                             data-filter="{{ task.value.title|lower }}"
                                             data-type="{% if task.value.is_goods %}goods{% else %}service{% endif %}"
                                             data-tracking-id="{{ task.value.task_id }}"
                                             class="govuk-accordion__section">
                                            <div class="govuk-!-padding-5 govuk-!-margin-bottom-5 {% if task.block_type == 'sub_task' %}govuk-!-margin-left-9{% endif %} great-grey-border great-bg-white">
                                                <a href="{% if task.value.goods_url %}{{ task.value.goods_url }}{% else %}{{ task.value.services_url }}{% endif %}"
                                                   class="govuk-heading-s govuk-!-margin-bottom-0 great-heading-link">
                                                    <h2 class="govuk-heading-s great-heading-link__heading">
                                                        <span>{{ task.value.title }}</span>
                                                    </h2>
                                                </a>
                                                <p class="govuk-body govuk-!-margin-bottom-3">{{ task.value.description }}</p>
                                                <div class="great-display-flex">
                                                    {% if task.value.is_goods %}
                                                        <span class="great-grey-border govuk-!-padding-2 govuk-!-margin-right-2 great-bg-lighter-grey great-font-weight-semi-bold">GOODS</span>
                                                        {% if task.value.goods_url %}
                                                            <span class="great-grey-border govuk-!-padding-2 govuk-!-margin-right-2 great-bg-lighter-grey great-font-weight-semi-bold">
                                                                {% if task.value.goods_url|url_type == 'internal' %}
                                                                    GREAT.GOV
                                                                {% else %}
                                                                    GOV.UK
                                                                {% endif %}
                                                            </span>
                                                        {% endif %}
                                                        {% if task.block_type == 'sub_task' %}
                                                            <span class="great-grey-border govuk-!-padding-2 govuk-!-margin-right-2 great-bg-lighter-grey great-font-weight-semi-bold">SUB-TASK</span>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if task.value.is_services %}
                                                        <span class="great-grey-border govuk-!-padding-2 govuk-!-margin-right-2 great-bg-lighter-grey great-font-weight-semi-bold">SERVICES</span>
                                                    {% endif %}
                                                    <!-- {% if task.value.necessity %}
                                                            <span class="govuk-tag govuk-!-margin-right-2">{{ item.value.necessity }}</span>
                                                        {% endif %}
                                                        {% if task.value.complexity %}
                                                            <span class="govuk-tag govuk-!-margin-right-2">{{ item.value.complexity }}</span>
                                                        {% endif %} -->
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="govuk-grid-column-one-third"></div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
