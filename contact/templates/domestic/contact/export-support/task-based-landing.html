{% extends 'domestic/base.html' %}
{% load breadcrumbs from component_tags %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load static %}
{% load add_govuk_classes from content_tags %}
{% block meta_tags %}<meta name="robots" content="noindex">{% endblock %}
{% block head_title %}{{ page.page_title }}{% endblock %}
{% block meta_title %}{{ page.page_title }}{% endblock %}
{% block body_js %}
    {{ block.super }}
    <script>
        document.getElementById('filter').addEventListener('keyup', (e) => {
            const search_term = e.target.value.toLowerCase();

            document.querySelectorAll('[data-filter]').forEach(el => {
                if (!el.dataset.filter.includes(search_term)) {
                    el.style.display = 'none'
                } else {
                    el.style.display = 'block'
                }
            })
        })
    </script>
{% endblock %}
{% block content %}
    <div class="govuk-!-padding-bottom-9 great great-bg-light-blue">
        <div class="great-container">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    {% if page.page_body %}
                        <div class="govuk-grid-row govuk-!-margin-top-5">
                            <div class="govuk-grid-column-one-quarter">
                                <h2 class="govuk-heading-m govuk-!-margin-top-5 govuk-!-margin-bottom-5">Export support</h2>
                                <ul class="govuk-list">
                                    {% for sub_category in page.page_body %}
                                        <li>
                                            <a class="govuk-link" href="#{{ sub_category.value.title }}">{{ sub_category.value.title }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="govuk-grid-column-three-quarters">
                                <div class="govuk-!-margin-bottom-5">
                                    <h1 class="govuk-heading-xl govuk-!-margin-top-5 govuk-!-margin-bottom-2">{{ page.page_title }}</h1>
                                    {% if page.page_intro %}{{ page.page_intro| richtext | add_govuk_classes }}{% endif %}
                                    <input class="govuk-input govuk-!-margin-top-3"
                                           id="filter"
                                           type="text"
                                           placeholder="Filter task list by key word" />
                                </div>
                                {% for sub_category in page.page_body %}
                                    <div id="{{ sub_category.value.title }}"
                                         data-filter="{{ sub_category.value.title|lower }}">
                                        <div class="govuk-!-padding-5 great-bg-white">
                                            <h2 class="govuk-heading-m">{{ sub_category.value.title }}</h2>
                                            <p class="govuk-body govuk-!-margin-bottom-0">{{ sub_category.value.description }}</p>
                                        </div>
                                        <ul class="govuk-list govuk-!-padding-5">
                                            {% for task in sub_category.value.task %}
                                                <li>
                                                    <a class="govuk-link" href="{{ task.url }}">{{ task.task }}</a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
