{% extends 'core/base.html' %}
{% load static %}

{% block head_title %}Upcoming events{% endblock %}

{% block content %}
<section id="filters">
    <div class="container">
        <form action="" method="get">
            <button type="submit" class="pill" name="when" value="all">All</button>
            <button type="submit" class="pill" name="when" value="today">Today</button>
            <button type="submit" class="pill" name="when" value="tomorrow">Tomorrow</button>
            <button type="submit" class="pill" name="when" value="this_week">This week</button>
            <button type="submit" class="pill" name="when" value="next_week">Next week</button>
            <button type="submit" class="pill" name="when" value="this_month">This month</button>
            <button type="submit" class="pill" name="when" value="next_month">Next month</button>
        </form>
    </div>
</section>

<section id="upcoming-events">
    <div class="container">
        <h1 class="heading-xlarge">Upcoming events</h1>
        {% regroup object_list|dictsort:"start_date" by start_date|date:"l d/m/Y" as events_by_date %}
        <ul>
            {% for event_by_date in events_by_date %}
            <li>
                <h4>{{ event_by_date.grouper }}</h4>
                <ul>
                    {% for event in event_by_date.list %}
                    <li>
                        <h5>{{ event.start_date|date:"fa" }} - {{ event.end_date|date:"fa" }}</h5>
                        <h6>{{ event.name }}</h6>
                        <p>{{ event.description }}</p>
                        {% if event.completed %}
                            {% if event.slide_show %}
                                <a href={{ event.slide_show.url }}>View slideshow</a>
                            {% else %}
                                <a href={{ event.slide_show.url }}>There are no reference materials from this event.</a>
                            {% endif %}
                            {% if event.video_recording %}
                                <div class="video-container">
                                  <video controls class="width-full" id="article-video">
                                      <source src="{{ event.video_recording.url }}" type="video/{{ event.video_recording.file_extension }}">
                                      <p>Your browser doesn't support HTML5 video. Here is a <a class="link" href="{{ event.video_recording.url }}">link to the video</a> instead.</p>
                                  </video>
                                </div>

                                {% if event.video_transcript %}
                                <details closed class="margin-bottom-0 rich-text">
                                  <summary>View video transcript</summary>
                                    <a href={{ event.video_transcript.url }}>Transcript</a>
                                </details>
                            {% endif %}
                            {% endif %}
                        {% else %}
                        <form action="{% url 'export_academy:booking' %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="event_id" value="{{ event.id }}">
                            {% if event.id in bookings %}
                            <input type="hidden" name="status" value="Cancelled">
                            <button type="submit" class="link">Cancel</button>
                            {% else %}
                            <input type="hidden" name="status" value="Confirmed">
                            <button type="submit" class="link">Book</button>
                            {% endif %}
                        {% endif %}
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </li>
            <hr>
            {% endfor %}
        </ul>
    </div>
</section>
{% endblock %}
