{% extends 'domestic/base.html' %}
{% load static %}

{% block head_title %}Upcoming events{% endblock %}

{% block content %}
<section id="event-list-section" class="topic-list-section">
    <div class="container">
        <div class="grid-row">
            <div class="column-third column-quarter-xl">
                <form id="events-forms" action="" method="GET">
                    <div class="filters">
                        <ul>
                            {% for field in filter.form %}
                            <li class="filter-section">
                                <input type="checkbox" id="{{ field.label }}" checked />
                                <label for="{{ field.label }}" role="button">Select event {{ field.label }}</label>
                                <div class="options checkbox-small">
                                    {{ field }}
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="filters-sticky-footer" id="filters-sticky-footer">
                        <input type="submit" id="submit" class="button primary-button update" value="Update">
                    </div>
                </form>
            </div>

            <div id="event-list" class="column-three-quarters-xl" >
                <h1 class="heading-xlarge">Upcoming events</h1>
                {% regroup object_list|dictsort:"start_date" by start_date|date:"l d/m/Y" as events_by_date %}
                <ul>
                    {% for event_by_date in events_by_date %}
                    <li>
                        <h4>{{ event_by_date.grouper }}</h4>
                        <ul>
                            {% for event in event_by_date.list %}
                            <li>
                                <h5>{{ event.start_date|date:"fa" }}</h5>
                                <h6>{{ event.types.all|join:" | "}}</h6>
                                <h6>{{ event.format }}</h6>
                                <h6>{{ event.name }}</h6>
                                <h6>Duration: {{ event.start_date|timesince:event.end_date }}</h6>
                                <p>{{ event.description|truncatechars:200 }}</p>
                                <form action="{% url 'export_academy:booking' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="event_id" value="{{ event.id }}">
                                    {% if event.id in bookings %}
                                        {% if event.completed %}
                                            {% if event.document %}
                                                <a href={{ event.document.url }}>View slideshow</a>
                                            {% else %}
                                                <a>There are no reference materials from this event.</a>
                                            {% endif %}
                                            {% if event.video_recording %}
                                                <a href={{ event.video_recording.url }}>View video</a>
                                            {% endif %}
                                        {% else %}
                                            <input type="hidden" name="status" value="Cancelled">
                                            <button type="submit" class="link">Cancel</button>
                                        {% endif %}
                                    {% else %}
                                    <input type="hidden" name="status" value="Confirmed">
                                    <button type="submit" class="link">Book</button>
                                    {% endif %}
                                </form>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>
                    <hr>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}
