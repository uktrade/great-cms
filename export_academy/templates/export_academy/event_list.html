{% extends 'domestic/base.html' %}
{% load static %}
{% load event_list_buttons %}
{% load wagtailcore_tags %}
{% load breadcrumbs from component_tags %}
{% load pagination from component_tags %}

{% block head_title %}UKEA Events{% endblock %}

{% block content %}
    {% block hero %}
        {% with content_snippet as hero %}
            <div class="ea-listing-page">
                    {% include 'components/export_academy_hero.html' with hero=hero hide_image_for_mobile=True state=state %}
            </div>
        {% endwith %}
    {% endblock %}
    <div id="breadcrumbs" class="great-display-from-tablet">
        {% breadcrumbs 'Events' %}
            <a href="/">great.gov.uk</a>
            <a href="{% pageurl landing_page %}">UK Export Academy</a>
        {% endbreadcrumbs %}
    </div>
    <div class="great">
        <section class="govuk-!-padding-top-3 background-white clearfix">
            <div class="container">
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-quarter govuk-!-padding-left-2">
                        <form id="events-form" action="" method="GET">
                            <div class="filters great-filters event-filters">
                                <a href="#" class="button primary-button mobile-filter-toggle" id="mobile-filter-toggle">Filters</a>
                                <ul>
                                    {% for field in filter.form|get_filters:request.user %}
                                    <li>
                                        <fieldset class="filter-section" aria-describedby="{{ field.label }}_label">
                                            <legend class="great-visually-hidden">{{ field.label }}</legend>
                                            <input type="checkbox" id="{{ field.label }}" class="filter-section-toggle" role="button" aria-expanded="false" aria-controls="{{ field.label }}_fields" />
                                            <label class="govuk-body-l arrows-left govuk-!-padding-left-2" for="{{ field.label }}" id="{{ field.label }}_label">{{ field.label }}</label>
                                            <div id="{{ field.label }}_fields" class="options checkbox-small">
                                                {% if request.GET.booking_period == 'upcoming' or request.GET.booking_period == 'past' %}
                                                    {% filter disable_period_radios %}
                                                        {{ field }}
                                                    {% endfilter %}
                                                {% else %}
                                                    {% filter set_all_events %}
                                                        {{ field }}
                                                    {% endfilter %}
                                                {% endif %}
                                            </div>
                                        </fieldset>
                                    </li>
                                    {% endfor %}
                                </ul>
                                <div class="filters-sticky-footer govuk-!-margin-top-7" id="filters-sticky-footer">
                                 <a href="#" class="button primary-button update" role="button">Apply filters<span class="verbose">With Javascript enabled, click this button to filter the results.</span></a>
                                 <a href="#" class="cancel link">Cancel</a>
                                </div>
                                <input type="submit" class="button primary-button govuk-!-margin-top-7" value="Update results">
                            </div>
                        </form>
                    </div>
                    <div id="event-list" class="govuk-grid-column-three-quarters">
                        {% if not page_obj %}
                            <p>There are currently no events available for the filters you have chosen.</p>
                            <p>Remove one or more of your filter choices to broaden your search.</p>
                        {% else %}
                            {% for event in page_obj %}
                            <div class="govuk-grid-row event-list-card">
                                <h4 class="govuk-!-padding-left-3 govuk-!-padding-right-3 event-title">{{ event.name }}</h4>
                                <div class="govuk-!-padding-left-3 govuk-!-padding-right-3 great-display-until-tablet">
                                    {% include 'export_academy/includes/event_duration.html' %}

                                    {% is_logged_in as show_logged_in_features %}
                                    {% if show_logged_in_features  %}
                                    <div class="govuk-!-margin-bottom-3">
                                        {% event_list_badges event %}
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="govuk-grid-column-one-quarter govuk-!-text-align-centre">
                                    <div class="great-background-light-blue event-date-container">
                                        <p class="weekday">{{ event.start_date|date:"D" }}</p>
                                        <p class="date">{{ event.start_date|date:"j M" }}</p>
                                        <p class="time">{{ event.start_date|date:"g:iA"|lower }}</p>
                                    </div>
                                    <div class="event-tags">
                                        {% for type in event.types.all %}
                                            <p class="great-background-light-blue margin-0 event-tag-item">{{ type }}</p>
                                        {% endfor %}
                                        <p class="great-background-light-blue margin-0 event-tag-item">{{ event.get_format_display }}</p>
                                    </div>
                                </div>
                                <div class="govuk-grid-column-three-quarters">
                                    <div class="great-display-from-tablet">
                                        {% include 'export_academy/includes/event_duration.html' %}
                                    </div>

                                    {% is_logged_in as show_logged_in_features %}
                                    {% if show_logged_in_features  %}
                                    <div class="govuk-!-margin-bottom-1 great-display-from-tablet">
                                        {% event_list_badges event %}
                                    </div>
                                    {% endif %}

                                    <p class='event-description'>{{event.description}}</p>

                                    {% event_list_buttons event %}
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                <div class="govuk-grid-row background-white govuk-grid-column-three-quarters markets-pagination">
                    {% pagination pagination_page=page_obj %}
                </div>
            </div>
        </section>
    </div>
{% endblock %}
{% block body_js %}
{{ block.super }}
<script src="{% static 'javascript/eventFilters.js' %}"></script>
<script src="{% static 'javascript/showMore.js'%}"></script>
<script type="text/javascript">
    $(function() {
        eventFilters.init();
    });
</script>
{% endblock %}
