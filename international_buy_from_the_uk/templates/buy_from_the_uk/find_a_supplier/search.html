{% extends './base.html' %}
{% load static %}
{% load buy_from_the_uk_filters %}
{% block head_title %}
    {% if form.errors %}Error:{% endif %}
    Buy from the UK find a supplier search
    {{ block.super }}
{% endblock %}
{% block meta_title %}Buy from the UK find a supplier search {{ block.super }}{% endblock %}
{% block content %}
    <section class="buy-from-the-uk-info-section govuk-!-padding-bottom-8">
        <div class="govuk-width-container great-container">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-two-thirds-from-desktop">
                    <div class="govuk-!-margin-bottom-8">{% include 'eyb/includes/breadcrumbs.html' with breadcrumbs=breadcrumbs %}</div>
                    <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">Find a UK supplier</h1>
                </div>
            </div>
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half-from-desktop">
                    <form id="buy-from-the-uk-search-form"
                          class="magna-header__search govuk-!-margin-bottom-4"
                          action=""
                          method="get">
                        <label for="magna-header-search-box" class="great-visually-hidden">Search</label>
                        <input id="magna-header-search-box"
                               type="text"
                               name="q"
                               placeholder="Search for a product or service">
                        <button type="submit">
                            <span class="great-visually-hidden">Search</span>
                        </button>
                        {{ form.page }}
                    </form>
                </div>
            </div>
        </div>
    </section>
    <section class="govuk-!-padding-top-6 govuk-!-padding-bottom-6">
        <div class="govuk-width-container great-container">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-quarter-from-desktop">
                    {% include '../includes/filters.html' with form=form is_find_a_supplier=True %}
                </div>
                <div class="govuk-grid-column-three-quarters-from-desktop">
                    {% if results %}
                        <div class="govuk-!-margin-bottom-4 great-grey-bottom-border">
                            <p class="govuk-body">
                                <strong>{{ pagination.paginator.count }} {{ pagination.paginator.count|pluralize:'result,results' }} found</strong>
                                {% if form.q.value %}
                                    <span>for</span>
                                    <strong class="govuk-tag govuk-tag--grey govuk-!-margin-bottom-1">{{ form.q.value }}</strong>
                                {% endif %}
                                {% if form.industries.value %}
                                    <span>in</span>
                                    {% for action in form.industries %}
                                        {% if action.data.value in form.industries.value %}
                                            <strong class="govuk-tag govuk-tag--grey govuk-!-margin-bottom-1">{{ action.choice_label }}</strong>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </p>
                        </div>
                        {% for company in results %}
                            {% url 'international_buy_from_the_uk:find-a-supplier-profile' company_number=company.number as profile_link %}
                            {% include '../includes/list_item.html' with logo=company.logo title=company.name link_url=profile_link company=company %}
                        {% endfor %}
                        <br />
                        <br />
                        <nav class="govuk-pagination" role="navigation" aria-label="results">
                            {% if pagination.has_previous %}
                                <div class="govuk-pagination__prev">
                                    <a class="govuk-link govuk-pagination__link"
                                       href="{{ request|get_url }}&page={{ pagination.previous_page_number }}"
                                       rel="prev">
                                        <svg class="govuk-pagination__icon govuk-pagination__icon--prev"
                                             xmlns="http://www.w3.org/2000/svg"
                                             height="13"
                                             width="15"
                                             aria-hidden="true"
                                             focusable="false"
                                             viewBox="0 0 15 13">
                                            <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z">
                                            </path>
                                        </svg>
                                        <span class="govuk-pagination__link-title">Previous</span></a>
                                </div>
                            {% endif %}
                            <ul class="govuk-pagination__list">
                                {% for i in page_range %}
                                    {% if pagination.number == i %}
                                        <li class="govuk-pagination__item govuk-pagination__item--current">
                                            <a class="govuk-link govuk-pagination__link"
                                               href="{{ request|get_url }}&page={{ i }}"
                                               aria-label="Page {{ i }}"
                                               aria-current="page">{{ i }}</a>
                                        </li>
                                    {% else %}
                                        {% if i == pagination.paginator.ELLIPSIS %}
                                            <li class="govuk-pagination__item govuk-pagination__item--ellipses">{{ i }}</li>
                                        {% else %}
                                            <li class="govuk-pagination__item">
                                                <a class="govuk-link govuk-pagination__link"
                                                   href="{{ request|get_url }}&page={{ i }}"
                                                   aria-label="Page {{ i }}">{{ i }}</a>
                                            </li>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </ul>
                            {% if pagination.has_next %}
                                <div class="govuk-pagination__next">
                                <a class="govuk-link govuk-pagination__link"
                                   href="{{ request|get_url }}&page={{ pagination.next_page_number }}"
                                   rel="next"> <span class="govuk-pagination__link-title">Next</span>
                                <svg class="govuk-pagination__icon govuk-pagination__icon--next"
                                     xmlns="http://www.w3.org/2000/svg"
                                     height="13"
                                     width="15"
                                     aria-hidden="true"
                                     focusable="false"
                                     viewBox="0 0 15 13">
                                    <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z">
                                    </path>
                                </svg>
                            </a>
                        </div>
                    {% endif %}
                </nav>
            {% else %}
                <p class="govuk-heading-m">No UK businesses match your search</p>
                <p class="govuk-body">Try different filters or a new search term.</p>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
{% block body_js %}
    {{ block.super }}
    <script>document.getElementsByClassName("govuk-accordion__controls")[0].style.display = 'none';</script>
{% endblock %}
