(()=>{"use strict";var e,t={1612:(e,t,n)=>{var o=n(9408),r=n(4530),i=n.n(r),s=n(7858),a=n.n(s);function c(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var l="function"==typeof Symbol&&Symbol.observable||"@@observable",m=function(){return Math.random().toString(36).substring(7).split("").join(".")},u={INIT:"@@redux/INIT"+m(),REPLACE:"@@redux/REPLACE"+m(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+m()}};function d(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function p(e,t,n){var o;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(c(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(c(1));return n(p)(e,t)}if("function"!=typeof e)throw new Error(c(2));var r=e,i=t,s=[],a=s,m=!1;function f(){a===s&&(a=s.slice())}function h(){if(m)throw new Error(c(3));return i}function y(e){if("function"!=typeof e)throw new Error(c(4));if(m)throw new Error(c(5));var t=!0;return f(),a.push(e),function(){if(t){if(m)throw new Error(c(6));t=!1,f();var n=a.indexOf(e);a.splice(n,1),s=null}}}function v(e){if(!d(e))throw new Error(c(7));if(void 0===e.type)throw new Error(c(8));if(m)throw new Error(c(9));try{m=!0,i=r(i,e)}finally{m=!1}for(var t=s=a,n=0;n<t.length;n++)(0,t[n])();return e}function b(e){if("function"!=typeof e)throw new Error(c(10));r=e,v({type:u.REPLACE})}function g(){var e,t=y;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(c(11));function n(){e.next&&e.next(h())}return n(),{unsubscribe:t(n)}}})[l]=function(){return this},e}return v({type:u.INIT}),(o={dispatch:v,subscribe:y,getState:h,replaceReducer:b})[l]=g,o}function f(e,t,n){const o=e.get(t);return void 0===o?n:o}class h{constructor(){this.commentElements=new Map,this.commentAnnotations=new Map,this.commentTabs=new Map,this.commentDesiredPositions=new Map,this.commentHeights=new Map,this.pinnedComment=null,this.commentCalculatedPositions=new Map,this.isDirty=!1}setCommentElement(e,t){null!==t?this.commentElements.set(e,t):this.commentElements.delete(e),this.isDirty=!0}setCommentAnnotation(e,t){this.commentAnnotations.set(e,t),this.commentTabs.set(e,t.getTab()||null),this.updateDesiredPosition(e),this.isDirty=!0}setCommentHeight(e,t){this.commentHeights.get(e)!==t&&(this.commentHeights.set(e,t),this.isDirty=!0)}setPinnedComment(e){this.pinnedComment=e,this.isDirty=!0}updateDesiredPosition(e){const t=this.commentAnnotations.get(e);if(!t)return;const n=t.getAnchorNode(e===this.pinnedComment);let o=n.getBoundingClientRect().top,r=n.parentElement;for(;r;)o+=r.scrollTop,r=r.parentElement;this.commentDesiredPositions.set(e,0!==o?o+-50:0)}refreshDesiredPositions(e=null){const t=new Map(this.commentDesiredPositions);this.commentAnnotations.forEach(((t,n)=>{this.getCommentTabVisible(e,n)&&this.updateDesiredPosition(n)})),this.commentDesiredPositions!==t&&(this.isDirty=!0)}refreshLayout(){if(!this.isDirty)return!1;const e=Array.from(this.commentElements.keys()).map((e=>({tab:f(this.commentTabs,e,null),position:f(this.commentDesiredPositions,e,0),height:f(this.commentHeights,e,0),comments:[e],containsPinnedComment:null!==this.pinnedComment&&e===this.pinnedComment,pinnedCommentPosition:0}))),t=new Map;e.forEach((e=>{const n=t.get(e.tab)||[];n.push(e),t.set(e.tab,n)}));const n=this.pinnedComment?this.commentDesiredPositions.get(this.pinnedComment):void 0,o=this.pinnedComment?this.commentTabs.get(this.pinnedComment):void 0;return Array.from(t.entries()).forEach((([e,t])=>{const r=this.pinnedComment&&o===e;t.sort(((e,t)=>e.position-t.position));let i=t,s=!0;for(;s;){s=!1;const e=[];let t=null;for(const o of i)t&&t.position+t.height+20>o.position?(s=!0,t.comments.push(...o.comments),o.containsPinnedComment&&(t.containsPinnedComment=!0,t.pinnedCommentPosition=o.pinnedCommentPosition+t.height),t.height+=o.height,!r&&t.position<50&&(t.position=100+t.height- -50),n&&t.containsPinnedComment&&(t.position=n-t.pinnedCommentPosition)):(e.push(o),t=o);i=e}i.forEach((e=>{let t=e.position;e.comments.forEach((e=>{this.commentCalculatedPositions.set(e,t);const n=this.commentHeights.get(e);n&&(t+=n+20)}))}))})),this.isDirty=!1,!0}getCommentTabVisible(e,t){return f(this.commentTabs,t,null)===e}getCommentVisible(e,t){return this.getCommentTabVisible(e,t)&&f(this.commentDesiredPositions,t,1)>0}getCommentPosition(e){return this.commentCalculatedPositions.has(e)?this.commentCalculatedPositions.get(e):this.commentDesiredPositions.get(e)}}let y=1,v=1;function b(){return y+=1,y}function g(){return v+=1,v}function E(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function w(e){return!!e&&!!e[ce]}function _(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===me}(e)||Array.isArray(e)||!!e[ae]||!!e.constructor[ae]||O(e)||D(e))}function C(e,t,n){void 0===n&&(n=!1),0===I(e)?(n?Object.keys:ue)(e).forEach((function(o){n&&"symbol"==typeof o||t(o,e[o],e)})):e.forEach((function(n,o){return t(o,n,e)}))}function I(e){var t=e[ce];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:O(e)?2:D(e)?3:0}function x(e,t){return 2===I(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function N(e,t,n){var o=I(e);2===o?e.set(t,n):3===o?(e.delete(t),e.add(n)):e[t]=n}function P(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function O(e){return oe&&e instanceof Map}function D(e){return re&&e instanceof Set}function k(e){return e.o||e.t}function A(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=de(e);delete t[ce];for(var n=ue(t),o=0;o<n.length;o++){var r=n[o],i=t[r];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[r]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function F(e,t){return void 0===t&&(t=!1),T(e)||w(e)||!_(e)||(I(e)>1&&(e.set=e.add=e.clear=e.delete=S),Object.freeze(e),t&&C(e,(function(e,t){return F(t,!0)}),!0)),e}function S(){E(2)}function T(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function R(e){var t=pe[e];return t||E(18,e),t}function j(e,t){pe[e]||(pe[e]=t)}function M(){return te}function L(e,t){t&&(R("Patches"),e.u=[],e.s=[],e.v=t)}function U(e){z(e),e.p.forEach($),e.p=null}function z(e){e===te&&(te=e.l)}function H(e){return te={p:[],l:te,h:e,m:!0,_:0}}function $(e){var t=e[ce];0===t.i||1===t.i?t.j():t.O=!0}function V(e,t){t._=t.p.length;var n=t.p[0],o=void 0!==e&&e!==n;return t.h.g||R("ES5").S(t,e,o),o?(n[ce].P&&(U(t),E(4)),_(e)&&(e=K(t,e),t.l||W(t,e)),t.u&&R("Patches").M(n[ce].t,e,t.u,t.s)):e=K(t,n,[]),U(t),t.u&&t.v(t.u,t.s),e!==se?e:void 0}function K(e,t,n){if(T(t))return t;var o=t[ce];if(!o)return C(t,(function(r,i){return q(e,o,t,r,i,n)}),!0),t;if(o.A!==e)return t;if(!o.P)return W(e,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var r=4===o.i||5===o.i?o.o=A(o.k):o.o;C(3===o.i?new Set(r):r,(function(t,i){return q(e,o,r,t,i,n)})),W(e,r,!1),n&&e.u&&R("Patches").R(o,n,e.u,e.s)}return o.o}function q(e,t,n,o,r,i){if(w(r)){var s=K(e,r,i&&t&&3!==t.i&&!x(t.D,o)?i.concat(o):void 0);if(N(n,o,s),!w(s))return;e.m=!1}if(_(r)&&!T(r)){if(!e.h.F&&e._<1)return;K(e,r),t&&t.A.l||W(e,r)}}function W(e,t,n){void 0===n&&(n=!1),e.h.F&&e.m&&F(t,n)}function B(e,t){var n=e[ce];return(n?k(n):e)[t]}function J(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var o=Object.getOwnPropertyDescriptor(n,t);if(o)return o;n=Object.getPrototypeOf(n)}}function X(e){e.P||(e.P=!0,e.l&&X(e.l))}function Z(e){e.o||(e.o=A(e.t))}function Y(e,t,n){var o=O(t)?R("MapSet").N(t,n):D(t)?R("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),o={i:n?1:0,A:t?t.A:M(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=o,i=fe;n&&(r=[o],i=he);var s=Proxy.revocable(r,i),a=s.revoke,c=s.proxy;return o.k=c,o.j=a,c}(t,n):R("ES5").J(t,n);return(n?n.A:M()).p.push(o),o}function G(e){return w(e)||E(22,e),function e(t){if(!_(t))return t;var n,o=t[ce],r=I(t);if(o){if(!o.P&&(o.i<4||!R("ES5").K(o)))return o.t;o.I=!0,n=Q(t,r),o.I=!1}else n=Q(t,r);return C(n,(function(t,r){o&&function(e,t){return 2===I(e)?e.get(t):e[t]}(o.t,t)===r||N(n,t,e(r))})),3===r?new Set(n):n}(e)}function Q(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return A(e)}var ee,te,ne="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),oe="undefined"!=typeof Map,re="undefined"!=typeof Set,ie="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,se=ne?Symbol.for("immer-nothing"):((ee={})["immer-nothing"]=!0,ee),ae=ne?Symbol.for("immer-draftable"):"__$immer_draftable",ce=ne?Symbol.for("immer-state"):"__$immer_state",le="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",me=""+Object.prototype.constructor,ue="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,de=Object.getOwnPropertyDescriptors||function(e){var t={};return ue(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},pe={},fe={get:function(e,t){if(t===ce)return e;var n=k(e);if(!x(n,t))return function(e,t,n){var o,r=J(t,n);return r?"value"in r?r.value:null===(o=r.get)||void 0===o?void 0:o.call(e.k):void 0}(e,n,t);var o=n[t];return e.I||!_(o)?o:o===B(e.t,t)?(Z(e),e.o[t]=Y(e.A.h,o,e)):o},has:function(e,t){return t in k(e)},ownKeys:function(e){return Reflect.ownKeys(k(e))},set:function(e,t,n){var o=J(k(e),t);if(null==o?void 0:o.set)return o.set.call(e.k,n),!0;if(!e.P){var r=B(k(e),t),i=null==r?void 0:r[ce];if(i&&i.t===n)return e.o[t]=n,e.D[t]=!1,!0;if(P(n,r)&&(void 0!==n||x(e.t,t)))return!0;Z(e),X(e)}return e.o[t]===n&&"number"!=typeof n&&(void 0!==n||t in e.o)||(e.o[t]=n,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==B(e.t,t)||t in e.t?(e.D[t]=!1,Z(e),X(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=k(e),o=Reflect.getOwnPropertyDescriptor(n,t);return o?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:o.enumerable,value:n[t]}:o},defineProperty:function(){E(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){E(12)}},he={};C(fe,(function(e,t){he[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),he.deleteProperty=function(e,t){return he.set.call(this,e,t,void 0)},he.set=function(e,t,n){return fe.set.call(this,e[0],t,n,e[0])};var ye=function(){function e(e){var t=this;this.g=ie,this.F=!0,this.produce=function(e,n,o){if("function"==typeof e&&"function"!=typeof n){var r=n;n=e;var i=t;return function(e){var t=this;void 0===e&&(e=r);for(var o=arguments.length,s=Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];return i.produce(e,(function(e){var o;return(o=n).call.apply(o,[t,e].concat(s))}))}}var s;if("function"!=typeof n&&E(6),void 0!==o&&"function"!=typeof o&&E(7),_(e)){var a=H(t),c=Y(t,e,void 0),l=!0;try{s=n(c),l=!1}finally{l?U(a):z(a)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return L(a,o),V(e,a)}),(function(e){throw U(a),e})):(L(a,o),V(s,a))}if(!e||"object"!=typeof e){if(void 0===(s=n(e))&&(s=e),s===se&&(s=void 0),t.F&&F(s,!0),o){var m=[],u=[];R("Patches").M(e,s,m,u),o(m,u)}return s}E(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var o=arguments.length,r=Array(o>1?o-1:0),i=1;i<o;i++)r[i-1]=arguments[i];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(r))}))};var o,r,i=t.produce(e,n,(function(e,t){o=e,r=t}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,o,r]})):[i,o,r]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){_(e)||E(8),w(e)&&(e=G(e));var t=H(this),n=Y(this,e,void 0);return n[ce].C=!0,z(t),n},t.finishDraft=function(e,t){var n=(e&&e[ce]).A;return L(n,t),V(void 0,n)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!ie&&E(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var o=t[n];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}n>-1&&(t=t.slice(n+1));var r=R("Patches").$;return w(e)?r(e,t):this.produce(e,(function(e){return r(e,t)}))},e}(),ve=new ye,be=ve.produce;ve.produceWithPatches.bind(ve),ve.setAutoFreeze.bind(ve),ve.setUseProxies.bind(ve),ve.applyPatches.bind(ve),ve.createDraft.bind(ve),ve.finishDraft.bind(ve);const ge=be,Ee="add-comment",we="update-comment",_e="delete-comment",Ce="resolve-comment",Ie="set-focused-comment",xe="add-reply",Ne="update-reply",Pe="delete-reply",Oe="invalidate-content-path";function De(e){return{type:Ee,comment:e}}function ke(e,t){return{type:we,commentId:e,update:t}}function Ae(e){return{type:_e,commentId:e}}function Fe(e){return{type:Ce,commentId:e}}function Se(e,{updatePinnedComment:t,forceFocus:n}={updatePinnedComment:!1,forceFocus:!1}){return{type:Ie,commentId:e,updatePinnedComment:t,forceFocus:n}}function Te(e,t){return{type:xe,commentId:e,reply:t}}function Re(e,t,n){return{type:Ne,commentId:e,replyId:t,update:n}}function je(e,t){return{type:Pe,commentId:e,replyId:t}}function Me(e){return{type:Oe,contentPath:e}}const Le={addComment:De,updateComment:ke,deleteComment:Ae,resolveComment:Fe,setFocusedComment:Se,addReply:Te,updateReply:Re,deleteReply:je,invalidateContentPath:Me};function Ue(e,t){return Object.assign(e,t)}function ze(e,t,n,{remoteId:o=null,mode:r="default",text:i="",deleted:s=!1}){return{localId:e,remoteId:o,mode:r,author:t,date:n,text:i,originalText:i,newText:"",deleted:s}}function He(e,t,n,o,r,i,{remoteId:s=null,mode:a="default",text:c="",resolved:l=!1,deleted:m=!1,replies:u=new Map}){return{contentpath:e,position:t,localId:n,annotation:o,remoteId:s,mode:a,author:r,date:i,text:c,originalText:c,replies:u,newReply:"",newText:"",deleted:m,resolved:l,remoteReplyCount:Array.from(u.values()).reduce(((e,t)=>null!==t.remoteId?e+1:e),0)}}(function(){function e(e,t){var n=r[e];return n?n.enumerable=t:r[e]=n={configurable:!0,enumerable:t,get:function(){var t=this[ce];return fe.get(t,e)},set:function(t){var n=this[ce];fe.set(n,e,t)}},n}function t(e){for(var t=e.length-1;t>=0;t--){var r=e[t][ce];if(!r.P)switch(r.i){case 5:o(r)&&X(r);break;case 4:n(r)&&X(r)}}}function n(e){for(var t=e.t,n=e.k,o=ue(n),r=o.length-1;r>=0;r--){var i=o[r];if(i!==ce){var s=t[i];if(void 0===s&&!x(t,i))return!0;var a=n[i],c=a&&a[ce];if(c?c.t!==s:!P(a,s))return!0}}var l=!!t[ce];return o.length!==ue(t).length+(l?0:1)}function o(e){var t=e.k;if(t.length!==e.t.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);if(n&&!n.get)return!0;for(var o=0;o<t.length;o++)if(!t.hasOwnProperty(o))return!0;return!1}var r={};j("ES5",{J:function(t,n){var o=Array.isArray(t),r=function(t,n){if(t){for(var o=Array(n.length),r=0;r<n.length;r++)Object.defineProperty(o,""+r,e(r,!0));return o}var i=de(n);delete i[ce];for(var s=ue(i),a=0;a<s.length;a++){var c=s[a];i[c]=e(c,t||!!i[c].enumerable)}return Object.create(Object.getPrototypeOf(n),i)}(o,t),i={i:o?5:4,A:n?n.A:M(),P:!1,I:!1,D:{},l:n,t,k:r,o:null,O:!1,C:!1};return Object.defineProperty(r,ce,{value:i,writable:!0}),r},S:function(e,n,r){r?w(n)&&n[ce].A===e&&t(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var n=t[ce];if(n){var r=n.t,i=n.k,s=n.D,a=n.i;if(4===a)C(i,(function(t){t!==ce&&(void 0!==r[t]||x(r,t)?s[t]||e(i[t]):(s[t]=!0,X(n)))})),C(r,(function(e){void 0!==i[e]||x(i,e)||(s[e]=!1,X(n))}));else if(5===a){if(o(n)&&(X(n),s.length=!0),i.length<r.length)for(var c=i.length;c<r.length;c++)s[c]=!1;else for(var l=r.length;l<i.length;l++)s[l]=!0;for(var m=Math.min(i.length,r.length),u=0;u<m;u++)i.hasOwnProperty(u)||(s[u]=!0),void 0===s[u]&&e(i[u])}}}}(e.p[0]),t(e.p))},K:function(e){return 4===e.i?n(e):o(e)}})})(),function(){function e(e,t){function n(){this.constructor=e}r(e,t),e.prototype=(n.prototype=t.prototype,new n)}function t(e){e.o||(e.D=new Map,e.o=new Map(e.t))}function n(e){e.o||(e.o=new Set,e.t.forEach((function(t){if(_(t)){var n=Y(e.A.h,t,e);e.p.set(t,n),e.o.add(n)}else e.o.add(t)})))}function o(e){e.O&&E(3,JSON.stringify(k(e)))}var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},i=function(){function n(e,t){return this[ce]={i:2,l:t,A:t?t.A:M(),P:!1,I:!1,o:void 0,D:void 0,t:e,k:this,C:!1,O:!1},this}e(n,Map);var r=n.prototype;return Object.defineProperty(r,"size",{get:function(){return k(this[ce]).size}}),r.has=function(e){return k(this[ce]).has(e)},r.set=function(e,n){var r=this[ce];return o(r),k(r).has(e)&&k(r).get(e)===n||(t(r),X(r),r.D.set(e,!0),r.o.set(e,n),r.D.set(e,!0)),this},r.delete=function(e){if(!this.has(e))return!1;var n=this[ce];return o(n),t(n),X(n),n.t.has(e)?n.D.set(e,!1):n.D.delete(e),n.o.delete(e),!0},r.clear=function(){var e=this[ce];o(e),k(e).size&&(t(e),X(e),e.D=new Map,C(e.t,(function(t){e.D.set(t,!1)})),e.o.clear())},r.forEach=function(e,t){var n=this;k(this[ce]).forEach((function(o,r){e.call(t,n.get(r),r,n)}))},r.get=function(e){var n=this[ce];o(n);var r=k(n).get(e);if(n.I||!_(r))return r;if(r!==n.t.get(e))return r;var i=Y(n.A.h,r,n);return t(n),n.o.set(e,i),i},r.keys=function(){return k(this[ce]).keys()},r.values=function(){var e,t=this,n=this.keys();return(e={})[le]=function(){return t.values()},e.next=function(){var e=n.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},r.entries=function(){var e,t=this,n=this.keys();return(e={})[le]=function(){return t.entries()},e.next=function(){var e=n.next();if(e.done)return e;var o=t.get(e.value);return{done:!1,value:[e.value,o]}},e},r[le]=function(){return this.entries()},n}(),s=function(){function t(e,t){return this[ce]={i:3,l:t,A:t?t.A:M(),P:!1,I:!1,o:void 0,t:e,k:this,p:new Map,O:!1,C:!1},this}e(t,Set);var r=t.prototype;return Object.defineProperty(r,"size",{get:function(){return k(this[ce]).size}}),r.has=function(e){var t=this[ce];return o(t),t.o?!!t.o.has(e)||!(!t.p.has(e)||!t.o.has(t.p.get(e))):t.t.has(e)},r.add=function(e){var t=this[ce];return o(t),this.has(e)||(n(t),X(t),t.o.add(e)),this},r.delete=function(e){if(!this.has(e))return!1;var t=this[ce];return o(t),n(t),X(t),t.o.delete(e)||!!t.p.has(e)&&t.o.delete(t.p.get(e))},r.clear=function(){var e=this[ce];o(e),k(e).size&&(n(e),X(e),e.o.clear())},r.values=function(){var e=this[ce];return o(e),n(e),e.o.values()},r.entries=function(){var e=this[ce];return o(e),n(e),e.o.entries()},r.keys=function(){return this.values()},r[le]=function(){return this.values()},r.forEach=function(e,t){for(var n=this.values(),o=n.next();!o.done;)e.call(t,o.value,o.value,this),o=n.next()},t}();j("MapSet",{N:function(e,t){return new i(e,t)},T:function(e,t){return new s(e,t)}})}();const $e=ge(((e,t)=>{const n=t=>{t.remoteId?t.resolved=!0:e.comments.delete(t.localId),e.focusedComment===t.localId&&(e.focusedComment=null),e.pinnedComment===t.localId&&(e.pinnedComment=null)};switch(t.type){case Ee:e.comments.set(t.comment.localId,t.comment),t.comment.remoteId&&(e.remoteCommentCount+=1);break;case we:{const n=e.comments.get(t.commentId);if(n){if(t.update.newText&&0===t.update.newText.length)break;Ue(n,t.update)}break}case _e:{const n=e.comments.get(t.commentId);if(!n)break;(t=>{t.remoteId?t.deleted=!0:e.comments.delete(t.localId),e.focusedComment===t.localId&&(e.focusedComment=null,e.forceFocus=!1),e.pinnedComment===t.localId&&(e.pinnedComment=null)})(n);break}case Ce:{const o=e.comments.get(t.commentId);if(!o)break;n(o);break}case Ie:(null===t.commentId||e.comments.has(t.commentId))&&(e.focusedComment=t.commentId,t.updatePinnedComment&&(e.pinnedComment=t.commentId),e.forceFocus=t.forceFocus);break;case xe:{const n=e.comments.get(t.commentId);if(!n||0===t.reply.text.length)break;t.reply.remoteId&&(n.remoteReplyCount+=1),n.replies.set(t.reply.localId,t.reply);break}case Ne:{const n=e.comments.get(t.commentId);if(!n)break;const o=n.replies.get(t.replyId);if(!o)break;if(t.update.newText&&0===t.update.newText.length)break;Ue(o,t.update);break}case Pe:{const n=e.comments.get(t.commentId);if(!n)break;const o=n.replies.get(t.replyId);if(!o)break;o.remoteId?o.deleted=!0:n.replies.delete(o.localId);break}case Oe:{const o=e.comments;for(const e of o.values())e.contentpath.startsWith(t.contentPath)&&n(e);break}}}),{comments:new Map,forceFocus:!1,focusedComment:null,pinnedComment:null,remoteCommentCount:0}),Ve="update-global-settings";function Ke(e){return{type:Ve,update:e}}const qe={user:null,commentsEnabled:!1,currentTab:null},We=function(e){for(var t=Object.keys(e),n={},o=0;o<t.length;o++){var r=t[o];"function"==typeof e[r]&&(n[r]=e[r])}var i,s=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:u.INIT}))throw new Error(c(12));if(void 0===n(void 0,{type:u.PROBE_UNKNOWN_ACTION()}))throw new Error(c(13))}))}(n)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var o=!1,r={},a=0;a<s.length;a++){var l=s[a],m=n[l],u=e[l],d=m(u,t);if(void 0===d)throw t&&t.type,new Error(c(14));r[l]=d,o=o||d!==u}return(o=o||s.length!==Object.keys(e).length)?r:e}}({comments:$e,settings:ge(((e,t)=>{t.type===Ve&&Ue(e,t.update)}),qe)});var Be="NOT_FOUND",Je=function(e,t){return e===t};function Xe(e,t){var n,o,r="object"==typeof t?t:{equalityCheck:t},i=r.equalityCheck,s=void 0===i?Je:i,a=r.maxSize,c=void 0===a?1:a,l=r.resultEqualityCheck,m=function(e){return function(t,n){if(null===t||null===n||t.length!==n.length)return!1;for(var o=t.length,r=0;r<o;r++)if(!e(t[r],n[r]))return!1;return!0}}(s),u=1===c?(n=m,{get:function(e){return o&&n(o.key,e)?o.value:Be},put:function(e,t){o={key:e,value:t}},getEntries:function(){return o?[o]:[]},clear:function(){o=void 0}}):function(e,t){var n=[];function o(e){var o=n.findIndex((function(n){return t(e,n.key)}));if(o>-1){var r=n[o];return o>0&&(n.splice(o,1),n.unshift(r)),r.value}return Be}return{get:o,put:function(t,r){o(t)===Be&&(n.unshift({key:t,value:r}),n.length>e&&n.pop())},getEntries:function(){return n},clear:function(){n=[]}}}(c,m);function d(){var t=u.get(arguments);if(t===Be){if(t=e.apply(null,arguments),l){var n=u.getEntries(),o=n.find((function(e){return l(e.value,t)}));o&&(t=o.value)}u.put(arguments,t)}return t}return d.clearCache=function(){return u.clear()},d}function Ze(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var n=t.map((function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+n+"]")}return t}function Ye(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r=function(){for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];var i,s=0,a={memoizeOptions:void 0},c=o.pop();if("object"==typeof c&&(a=c,c=o.pop()),"function"!=typeof c)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof c+"]");var l=a,m=l.memoizeOptions,u=void 0===m?n:m,d=Array.isArray(u)?u:[u],p=Ze(o),f=e.apply(void 0,[function(){return s++,c.apply(null,arguments)}].concat(d)),h=e((function(){for(var e=[],t=p.length,n=0;n<t;n++)e.push(p[n].apply(null,arguments));return i=f.apply(null,e)}));return Object.assign(h,{resultFunc:c,memoizedResultFunc:f,dependencies:p,lastResult:function(){return i},recomputations:function(){return s},resetRecomputations:function(){return s=0}}),h};return r}var Ge=Ye(Xe);const Qe=e=>e.comments.comments,et=e=>e.comments.focusedComment;function tt(e){return Ge(Qe,(t=>[...t.values()].filter((t=>t.contentpath===e&&!(t.deleted||t.resolved)))))}function nt(e){return Ge(Qe,(t=>{const n=t.get(e);if(void 0===n||!n.deleted&&!n.resolved)return n}))}const ot=e=>e.settings.commentsEnabled,rt=Ge(Qe,(e=>e.comments.remoteCommentCount),((e,t)=>t!==e.size||Array.from(e.values()).some((e=>!(!e.deleted&&!e.resolved&&e.replies.size===e.remoteReplyCount&&e.originalText===e.text)||Array.from(e.replies.values()).some((e=>e.deleted||e.originalText!==e.text)))))),it=e=>[...e.comments.comments.values()].filter((e=>!e.deleted&&!e.resolved)).length;var st=n(2636),at=n.n(st),ct=n(1302);const lt=new Intl.DateTimeFormat([],{dateStyle:"medium",timeStyle:"short"}),mt=({commentReply:e,store:t,onResolve:n,onEdit:s,onDelete:a,descriptionId:c,focused:l})=>{const{author:m,date:u}=e,[d,p]=(0,r.useState)(!1);(0,r.useEffect)((()=>{d&&!l&&p(!1)}),[l]);const f=(0,r.useRef)(null),h=(0,r.useRef)(null),y=e=>{e.preventDefault(),e.stopPropagation(),p(!d)};(0,r.useEffect)((()=>{d&&setTimeout((()=>f.current?.focus()),1)}),[d]);const v=e=>{h.current&&e.target instanceof Node&&!h.current.contains(e.target)&&p(!1)};(0,r.useEffect)((()=>(document.addEventListener("click",v,!0),()=>{document.removeEventListener("click",v,!0)})),[]);const b=new Date(u).toISOString();return i().createElement("div",{className:"comment-header"},i().createElement("div",{className:"comment-header__actions"},(s||a||n)&&i().createElement("div",{className:"comment-header__action comment-header__action--more",ref:h},i().createElement("details",{open:d,onClick:y},i().createElement("summary",{"aria-label":(0,o.ih)("More actions"),"aria-haspopup":"menu",role:"button",onClick:y,"aria-expanded":d},i().createElement(ct.Z,{name:"ellipsis-v"})),i().createElement("div",{className:"comment-header__more-actions",role:"menu",ref:f},s&&i().createElement("button",{type:"button",role:"menuitem",onClick:async n=>{n.preventDefault(),s&&s(e,t)}},(0,o.ih)("Edit")),a&&i().createElement("button",{type:"button",role:"menuitem",onClick:async n=>{n.preventDefault(),a&&a(e,t)}},(0,o.ih)("Delete")),n&&i().createElement("button",{type:"button",role:"menuitem",onClick:o=>{o.preventDefault(),n&&n(e,t)}},(0,o.ih)("Resolve")))))),m&&m.avatarUrl&&i().createElement("img",{className:"comment-header__avatar",src:m.avatarUrl,alt:"",decoding:"async",loading:"lazy"}),i().createElement("span",{id:c},i().createElement("p",{className:"comment-header__author"},m?m.name:""),i().createElement("p",{className:"comment-header__date"},i().createElement("time",{dateTime:b},lt.format(u)))))},ut=i().forwardRef((({value:e,className:t,placeholder:n,onChange:o,focusOnMount:r,focusTarget:s=!1,additionalAttributes:a={}},c)=>{const l=i().useRef(null);return i().useImperativeHandle(c,(()=>l.current)),i().useEffect((()=>{l.current&&(l.current.style.height="",l.current.style.height=l.current.scrollHeight+"px")}),[e,l]),i().useEffect((()=>{r&&l.current&&l.current.focus()}),[l]),i().createElement("textarea",{"data-focus-target":s,rows:1,style:{resize:"none",overflowY:"hidden"},className:t,placeholder:n,ref:l,onChange:e=>{o&&o(e.target.value)},value:e,...a})}));async function dt(e,t,n){n.dispatch(Re(e.localId,t.localId,{mode:"saving"}));try{n.dispatch(Re(e.localId,t.localId,{mode:"default",text:t.newText,author:t.author}))}catch(o){console.error(o),n.dispatch(Re(e.localId,t.localId,{mode:"save_error"}))}}async function pt(e,t,n){n.dispatch(Re(e.localId,t.localId,{mode:"deleting"}));try{n.dispatch(je(e.localId,t.localId))}catch(o){n.dispatch(Re(e.localId,t.localId,{mode:"delete_error"}))}}class ft extends i().Component{renderEditing(){const{comment:e,reply:t,store:n,isFocused:r}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:t,store:n,focused:r}),i().createElement("form",{onSubmit:async o=>{o.preventDefault(),await dt(e,t,n)}},i().createElement(ut,{className:"comment-reply__input",value:t.newText,onChange:o=>{n.dispatch(Re(e.localId,t.localId,{newText:o}))}}),i().createElement("div",{className:"comment-reply__actions"},i().createElement("button",{type:"submit",disabled:0===t.newText.length,className:"comment-reply__button comment-reply__button--primary"},(0,o.ih)("Save")),i().createElement("button",{type:"button",className:"comment-reply__button",onClick:o=>{o.preventDefault(),n.dispatch(Re(e.localId,t.localId,{mode:"default",newText:t.text}))}},(0,o.ih)("Cancel")))))}renderSaving(){const{reply:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment-reply__text"},e.text),i().createElement("div",{className:"comment-reply__progress"},(0,o.ih)("Saving...")))}renderSaveError(){const{comment:e,reply:t,store:n,isFocused:r}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:t,store:n,focused:r}),i().createElement("p",{className:"comment-reply__text"},t.text),i().createElement("div",{className:"comment-reply__error"},(0,o.ih)("Save error"),i().createElement("button",{type:"button",className:"comment-reply__button",onClick:async o=>{o.preventDefault(),await dt(e,t,n)}},(0,o.ih)("Retry"))))}renderDeleteConfirm(){const{comment:e,reply:t,store:n,isFocused:r}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:t,store:n,focused:r}),i().createElement("p",{className:"comment-reply__text"},t.text),i().createElement("div",{className:"comment-reply__confirm-delete"},(0,o.ih)("Are you sure?"),i().createElement("button",{type:"button",className:"comment-reply__button",onClick:o=>{o.preventDefault(),n.dispatch(Re(e.localId,t.localId,{mode:"default"}))}},(0,o.ih)("Cancel")),i().createElement("button",{type:"button",className:"comment-reply__button comment-reply__button--primary",onClick:async o=>{o.preventDefault(),await pt(e,t,n)}},(0,o.ih)("Delete"))))}renderDeleting(){const{reply:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment-reply__text"},e.text),i().createElement("div",{className:"comment-reply__progress"},(0,o.ih)("Deleting")))}renderDeleteError(){const{comment:e,reply:t,store:n,isFocused:r}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:t,store:n,focused:r}),i().createElement("p",{className:"comment-reply__text"},t.text),i().createElement("div",{className:"comment-reply__error"},(0,o.ih)("Delete error"),i().createElement("button",{type:"button",className:"comment-reply__button",onClick:async o=>{o.preventDefault(),n.dispatch(Re(e.localId,t.localId,{mode:"default"}))}},(0,o.ih)("Cancel")),i().createElement("button",{type:"button",className:"comment-reply__button",onClick:async o=>{o.preventDefault(),await pt(e,t,n)}},(0,o.ih)("Retry"))))}renderDefault(){const{comment:e,reply:t,store:n,isFocused:r}=this.props;let s,a;(null===t.author||this.props.user&&this.props.user.id===t.author.id)&&(s=()=>{n.dispatch(Re(e.localId,t.localId,{mode:"editing",newText:t.text}))},a=()=>{n.dispatch(Re(e.localId,t.localId,{mode:"delete_confirm"}))});let c="";return t.remoteId&&t.text===t.originalText||(c=(0,o.ih)("Save the page to save this reply")),i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:t,store:n,onEdit:s,onDelete:a,focused:r}),i().createElement("p",{className:"comment-reply__text"},t.text),c&&i().createElement("div",{className:"comment__notice-placeholder"},i().createElement("div",{className:"comment__notice",role:"status"},i().createElement(ct.Z,{name:"info-circle"}),c)))}render(){let e;switch(this.props.reply.mode){case"editing":e=this.renderEditing();break;case"saving":e=this.renderSaving();break;case"save_error":e=this.renderSaveError();break;case"delete_confirm":e=this.renderDeleteConfirm();break;case"deleting":e=this.renderDeleting();break;case"delete_error":e=this.renderDeleteError();break;default:e=this.renderDefault()}return i().createElement("li",{key:this.props.reply.localId,className:`comment-reply comment-reply--mode-${this.props.reply.mode}`,"data-reply-id":this.props.reply.localId},e)}}async function ht(e,t){t.dispatch(ke(e.localId,{mode:"saving"}));try{t.dispatch(ke(e.localId,{mode:"default",text:e.newText,remoteId:e.remoteId,author:e.author,date:e.date}))}catch(n){console.error(n),t.dispatch(ke(e.localId,{mode:"save_error"}))}}async function yt(e,t){t.dispatch(ke(e.localId,{mode:"deleting"}));try{t.dispatch(Ae(e.localId))}catch(n){console.error(n),t.dispatch(ke(e.localId,{mode:"delete_error"}))}}function vt(e,t){t.dispatch(Fe(e.localId))}class bt extends i().Component{renderReplies({hideNewReply:e=!1}={}){const{comment:t,isFocused:n,store:r,user:s}=this.props;if(!t.remoteId)return null;const a=[];let c,l=!1;for(const e of t.replies.values())"saving"!==e.mode&&"editing"!==e.mode||(l=!0),e.deleted||a.push(i().createElement(ft,{key:e.localId,store:r,user:s,comment:t,reply:e,isFocused:n}));if(e||l||!n&&!t.newReply){if(0===a.length)return null}else c=i().createElement("form",{onSubmit:async e=>{e.preventDefault();const n=ze(g(),s,Date.now(),{text:t.newReply,mode:"default"});r.dispatch(Te(t.localId,n)),r.dispatch(ke(t.localId,{newReply:""}))}},i().createElement(ut,{className:"comment__reply-input",placeholder:(0,o.ih)("Enter your reply..."),value:t.newReply,onChange:e=>{r.dispatch(ke(t.localId,{newReply:e}))}}),i().createElement("div",{className:"comment__reply-actions"},i().createElement("button",{disabled:0===t.newReply.length,type:"submit",className:"comment__button comment__button--primary"},(0,o.ih)("Reply")),i().createElement("button",{type:"button",onClick:e=>{e.preventDefault(),r.dispatch(ke(t.localId,{newReply:""})),r.dispatch(Se(null)),e.stopPropagation()},className:"comment__button"},(0,o.ih)("Cancel"))));return i().createElement(i().Fragment,null,i().createElement("ul",{className:"comment__replies"},a),c)}renderCreating(){const{comment:e,store:t,isFocused:n}=this.props,r=`comment-description-${e.localId}`;return i().createElement(i().Fragment,null,i().createElement(mt,{descriptionId:r,commentReply:e,store:t,focused:n}),i().createElement("form",{onSubmit:async n=>{n.preventDefault(),await ht(e,t)}},i().createElement(ut,{focusTarget:n,className:"comment__input",value:e.newText,onChange:n=>{t.dispatch(ke(e.localId,{newText:n}))},placeholder:(0,o.ih)("Enter your comments..."),additionalAttributes:{"aria-describedby":r}}),i().createElement("div",{className:"comment__actions"},i().createElement("button",{disabled:0===e.newText.length,type:"submit",className:"comment__button comment__button--primary"},(0,o.ih)("Comment")),i().createElement("button",{type:"button",onClick:n=>{n.preventDefault(),t.dispatch(Ae(e.localId))},className:"comment__button"},(0,o.ih)("Cancel")))))}renderEditing(){const{comment:e,store:t,isFocused:n}=this.props,r=`comment-description-${e.localId}`;return i().createElement(i().Fragment,null,i().createElement(mt,{descriptionId:r,commentReply:e,store:t,focused:n}),i().createElement("form",{onSubmit:async n=>{n.preventDefault(),await ht(e,t)}},i().createElement(ut,{focusTarget:n,className:"comment__input",value:e.newText,additionalAttributes:{"aria-describedby":r},onChange:n=>{t.dispatch(ke(e.localId,{newText:n}))}}),i().createElement("div",{className:"comment__actions"},i().createElement("button",{disabled:0===e.newText.length,type:"submit",className:"comment__button comment__button--primary"},(0,o.ih)("Save")),i().createElement("button",{type:"button",onClick:n=>{n.preventDefault(),t.dispatch(ke(e.localId,{mode:"default",newText:e.text}))},className:"comment__button"},(0,o.ih)("Cancel")))),this.renderReplies({hideNewReply:!0}))}renderSaving(){const{comment:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment__text"},e.text),i().createElement("div",{className:"comment__progress"},(0,o.ih)("Saving...")),this.renderReplies({hideNewReply:!0}))}renderSaveError(){const{comment:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment__text"},e.text),this.renderReplies({hideNewReply:!0}),i().createElement("div",{className:"comment__error"},(0,o.ih)("Save error"),i().createElement("button",{type:"button",className:"comment__button",onClick:async n=>{n.preventDefault(),await ht(e,t)}},(0,o.ih)("Retry"))))}renderDeleteConfirm(){const{comment:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment__text"},e.text),i().createElement("div",{className:"comment__confirm-delete"},(0,o.ih)("Are you sure?"),i().createElement("button",{type:"button",className:"comment__button",onClick:n=>{n.preventDefault(),t.dispatch(ke(e.localId,{mode:"default"}))}},(0,o.ih)("Cancel")),i().createElement("button",{type:"button",className:"comment__button button button-small no",onClick:async n=>{n.preventDefault(),await yt(e,t)}},(0,o.ih)("Delete"))),this.renderReplies({hideNewReply:!0}))}renderDeleting(){const{comment:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment__text"},e.text),i().createElement("div",{className:"comment__progress"},(0,o.ih)("Deleting")),this.renderReplies({hideNewReply:!0}))}renderDeleteError(){const{comment:e,store:t,isFocused:n}=this.props;return i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,focused:n}),i().createElement("p",{className:"comment__text"},e.text),this.renderReplies({hideNewReply:!0}),i().createElement("div",{className:"comment__error"},(0,o.ih)("Delete error"),i().createElement("button",{type:"button",className:"comment__button",onClick:async n=>{n.preventDefault(),t.dispatch(ke(e.localId,{mode:"default"}))}},(0,o.ih)("Cancel")),i().createElement("button",{type:"button",className:"comment__button",onClick:async n=>{n.preventDefault(),await yt(e,t)}},(0,o.ih)("Retry"))))}renderDefault(){const{comment:e,store:t,isFocused:n}=this.props;let r,s;(null===e.author||this.props.user&&this.props.user.id===e.author.id)&&(r=()=>{t.dispatch(ke(e.localId,{mode:"editing",newText:e.text}))},s=()=>{t.dispatch(ke(e.localId,{mode:"delete_confirm"}))});let a="";return e.remoteId?e.text!==e.originalText&&(a=(0,o.ih)("Save the page to save this comment")):a=(0,o.ih)("Save the page to add this comment"),i().createElement(i().Fragment,null,i().createElement(mt,{commentReply:e,store:t,onResolve:vt,onEdit:r,onDelete:s,focused:n}),i().createElement("p",{className:"comment__text"},e.text),a&&i().createElement("div",{className:"comment__notice-placeholder"},i().createElement("div",{className:"comment__notice",role:"status"},i().createElement(ct.Z,{name:"info-circle"}),a)),this.renderReplies())}render(){let e;switch(this.props.comment.mode){case"creating":e=this.renderCreating();break;case"editing":e=this.renderEditing();break;case"saving":e=this.renderSaving();break;case"save_error":e=this.renderSaveError();break;case"delete_confirm":e=this.renderDeleteConfirm();break;case"deleting":e=this.renderDeleting();break;case"delete_error":e=this.renderDeleteError();break;default:e=this.renderDefault()}const t=this.props.layout.getCommentPosition(this.props.comment.localId);return i().createElement(at(),{focusTrapOptions:{preventScroll:!0,clickOutsideDeactivates:!0,onDeactivate:()=>{this.props.store.dispatch(Se(null,{updatePinnedComment:!0,forceFocus:!1}))},initialFocus:'[data-focus-target="true"]',delayFocus:!1},active:this.props.isFocused&&this.props.forceFocus},i().createElement("li",{tabIndex:-1,"data-focus-target":this.props.isFocused&&!["creating","editing"].includes(this.props.comment.mode),key:this.props.comment.localId,className:`comment comment--mode-${this.props.comment.mode} ${this.props.isFocused?"comment--focused":""}`,style:{position:"absolute",top:`${t}px`,display:this.props.isVisible?"block":"none"},"data-comment-id":this.props.comment.localId,onClick:()=>{this.props.store.dispatch(Se(this.props.comment.localId,{updatePinnedComment:!1,forceFocus:this.props.isFocused&&this.props.forceFocus}))},onDoubleClick:()=>{this.props.store.dispatch(Se(this.props.comment.localId,{updatePinnedComment:!0,forceFocus:!0}))}},e))}componentDidMount(){const e=a().findDOMNode(this);e instanceof HTMLElement&&(this.props.layout.setCommentElement(this.props.comment.localId,e),this.props.isVisible&&this.props.layout.setCommentHeight(this.props.comment.localId,e.offsetHeight))}componentWillUnmount(){this.props.layout.setCommentElement(this.props.comment.localId,null)}componentDidUpdate(){const e=a().findDOMNode(this);this.props.isVisible&&e instanceof HTMLElement&&this.props.layout.setCommentHeight(this.props.comment.localId,e.offsetHeight)}}function gt({prefix:e,value:t,fieldName:n}){return i().createElement("input",{type:"hidden",name:`${e}-${n}`,value:null===t?"":t,id:`id_${e}-${n}`})}function Et({reply:e,formNumber:t,prefix:n}){const o=`${n}-${t}`;return i().createElement("fieldset",null,i().createElement(gt,{fieldName:"DELETE",value:e.deleted?1:"",prefix:o}),i().createElement(gt,{fieldName:"id",value:e.remoteId,prefix:o}),i().createElement(gt,{fieldName:"text",value:e.text,prefix:o}))}function wt({replies:e,prefix:t,remoteReplyCount:n}){const o=`${t}-replies`,r=e.map(((e,t)=>i().createElement(Et,{key:e.localId,formNumber:t,reply:e,prefix:o})));return i().createElement(i().Fragment,null,i().createElement(gt,{fieldName:"TOTAL_FORMS",value:e.length,prefix:o}),i().createElement(gt,{fieldName:"INITIAL_FORMS",value:n,prefix:o}),i().createElement(gt,{fieldName:"MIN_NUM_FORMS",value:"0",prefix:o}),i().createElement(gt,{fieldName:"MAX_NUM_FORMS",value:"",prefix:o}),r)}function _t({comment:e,formNumber:t,prefix:n}){const o=`${n}-${t}`;return i().createElement("fieldset",null,i().createElement(gt,{fieldName:"DELETE",value:e.deleted?1:"",prefix:o}),i().createElement(gt,{fieldName:"resolved",value:e.resolved?1:"",prefix:o}),i().createElement(gt,{fieldName:"id",value:e.remoteId,prefix:o}),i().createElement(gt,{fieldName:"contentpath",value:e.contentpath,prefix:o}),i().createElement(gt,{fieldName:"text",value:e.text,prefix:o}),i().createElement(gt,{fieldName:"position",value:e.position,prefix:o}),i().createElement(wt,{replies:Array.from(e.replies.values()),prefix:o,remoteReplyCount:e.remoteReplyCount}))}function Ct({comments:e,remoteCommentCount:t}){const n="comments",o=e.map(((e,t)=>i().createElement(_t,{key:e.localId,comment:e,formNumber:t,prefix:n})));return i().createElement(i().Fragment,null,i().createElement(gt,{fieldName:"TOTAL_FORMS",value:e.length,prefix:n}),i().createElement(gt,{fieldName:"INITIAL_FORMS",value:t,prefix:n}),i().createElement(gt,{fieldName:"MIN_NUM_FORMS",value:"0",prefix:n}),i().createElement(gt,{fieldName:"MAX_NUM_FORMS",value:"",prefix:n}),o)}const It=(e,t)=>{const n=f(e,String(t),{name:"",avatar_url:""});return{id:t,name:n.name,avatarUrl:n.avatar_url}};function xt(e,t,n){const o=e.getState(),{commentsEnabled:r,user:s,currentTab:a}=o.settings,{focusedComment:c,forceFocus:l}=o.comments;let m=n;r&&s||(m=[]),m=m.filter((({deleted:e,resolved:t})=>!(e||t)));const u=m.map((n=>i().createElement(bt,{key:n.localId,store:e,layout:t,user:s,comment:n,isFocused:n.localId===c,forceFocus:l,isVisible:t.getCommentVisible(a,n.localId)})));return i().createElement("ol",{className:"comments-list"},u)}class Nt{constructor(){this.utils={selectCommentsForContentPathFactory:tt,selectCommentFactory:nt},this.selectors={selectComments:Qe,selectEnabled:ot,selectFocused:et,selectIsDirty:rt,selectCommentCount:it},this.actions=Le,this.store=p(We,{settings:qe}),this.layout=new h}setUser(e,t){this.store.dispatch(Ke({user:It(t,e)}))}updateAnnotation(e,t){this.attachAnnotationLayout(e,t),this.store.dispatch(ke(t,{annotation:e}))}attachAnnotationLayout(e,t){this.layout.setCommentAnnotation(t,e)}setCurrentTab(e){this.store.dispatch(Ke({currentTab:e}))}makeComment(e,t,n=""){const o=b();return this.attachAnnotationLayout(e,o),this.store.dispatch(De(He(t,n,o,e,this.store.getState().settings.user,Date.now(),{mode:"creating"}))),this.store.dispatch(Se(o,{updatePinnedComment:!0,forceFocus:!0})),o}setVisible(e){this.store.dispatch(Ke({commentsEnabled:e}))}invalidateContentPath(e){this.store.dispatch(Me(e))}updateContentPath(e,t){this.store.dispatch(ke(e,{contentpath:t}))}renderApp(e,t,n,o,r){let s=null;this.setUser(n,r);let c=null;const l=new URLSearchParams(window.location.search).get("comment");l&&(c=parseInt(l,10));const m=()=>{const n=this.store.getState(),o=Array.from(n.comments.comments.values());a().render(i().createElement(Ct,{comments:o.filter((e=>"creating"!==e.mode)),remoteCommentCount:n.comments.remoteCommentCount}),t),n.comments.pinnedComment!==s&&(this.layout.setPinnedComment(n.comments.pinnedComment),s=n.comments.pinnedComment),a().render(xt(this.store,this.layout,o),e,(()=>{this.layout.refreshDesiredPositions(n.settings.currentTab),this.layout.refreshLayout()&&a().render(xt(this.store,this.layout,o),e)}))};for(const e of o){const t=b();this.store.dispatch(De(He(e.contentpath,e.position,t,null,It(r,e.user),Date.parse(e.created_at),{remoteId:e.pk,text:e.text,deleted:e.deleted,resolved:e.resolved})));for(const n of e.replies)this.store.dispatch(Te(t,ze(g(),It(r,n.user),Date.parse(n.created_at),{remoteId:n.pk,text:n.text,deleted:n.deleted})));c&&e.pk===c&&this.store.dispatch(Se(t,{updatePinnedComment:!0,forceFocus:!0}))}m(),this.store.subscribe(m),document.body.addEventListener("mousedown",(e=>{e.target instanceof HTMLElement&&(e.target.closest("#comments, [data-annotation], [data-comment-add]")||setTimeout((()=>{this.store.dispatch(Se(null,{updatePinnedComment:!0,forceFocus:!1}))}),200))})),document.body.addEventListener("commentAnchorVisibilityChange",(()=>{this.layout.refreshDesiredPositions(this.store.getState().settings.currentTab),this.layout.refreshLayout()&&m()}))}}window.comments=(()=>{const e=new Nt;function t(e){return(e.ctrlKey||e.metaKey)&&e.altKey&&77===e.keyCode}function n(e){if(e.closest("[data-contentpath-disabled]"))return"";let t=e.closest("[data-contentpath]");const n=[];for(;null!==t;)n.push(t.dataset.contentpath),t=t.parentElement.closest("[data-contentpath]");return n.reverse(),n.join(".")}class r{constructor(e,t){this.node=t,this.fieldNode=e,this.unsubscribe=null}subscribeToUpdates(t){const{selectFocused:n,selectEnabled:o}=e.selectors,r=e.utils.selectCommentFactory(t),i=e.store,s=i.getState();let a=n(s)===t,c=o(s);a&&this.onFocus(),c&&this.show(),this.unsubscribe=i.subscribe((()=>{const e=i.getState();r(e)||this.onDelete();const s=n(e)===t;s!==a&&(a?this.onUnfocus():this.onFocus(),a=s),c!==o(e)&&(c?this.hide():this.show(),c=o(e))})),this.setOnClickHandler(t)}onDelete(){this.node.remove(),this.unsubscribe&&this.unsubscribe()}onFocus(){this.node.classList.add("w-field__comment-button--focused"),this.node.ariaLabel=(0,o.ih)("Unfocus comment")}onUnfocus(){this.node.classList.remove("w-field__comment-button--focused"),this.node.ariaLabel=(0,o.ih)("Focus comment")}show(){this.node.classList.remove("u-hidden")}hide(){this.node.classList.add("u-hidden")}setOnClickHandler(t){this.node.addEventListener("click",(()=>{e.store.dispatch(e.actions.setFocusedComment(t,{updatePinnedComment:!0,forceFocus:!0}))}))}getTab(){return this.fieldNode.closest('[role="tabpanel"]')?.getAttribute("id")}getAnchorNode(){return this.fieldNode}}class i extends Error{constructor(e,...t){super(...t),this.name="MissingElementError",this.element=e}}class s{constructor({fieldNode:e,commentAdditionNode:t,annotationTemplateNode:o}){if(this.fieldNode=e,this.contentpath=n(e),!t)throw new i(t);if(this.commentAdditionNode=t,!o)throw new i(o);this.annotationTemplateNode=o,this.updateVisibility(!1)}register(){if(!this.contentpath)return;const{selectEnabled:n}=e.selectors,o=e.store.getState();let r=n(o);const i=e.utils.selectCommentsForContentPathFactory(this.contentpath);let s=i(o);this.updateVisibility(0===s.length&&r);const a=e.store.subscribe((()=>{const t=e.store.getState(),o=i(t),a=n(t),c=s!==o,l=r!==a;c&&(s=o,s.filter((e=>null===e.annotation)).forEach((t=>{const n=this.getAnnotationForComment(t);e.updateAnnotation(n,t.localId),n.subscribeToUpdates(t.localId)}))),(l||c)&&(r=a,this.updateVisibility(0===s.length&&r))}));o.comments.comments.forEach((t=>{if(t.contentpath===this.contentpath){const n=this.getAnnotationForComment(t);e.updateAnnotation(n,t.localId),n.subscribeToUpdates(t.localId)}}));const c=()=>{const t=this.getAnnotationForComment(),n=e.makeComment(t,this.contentpath);t.subscribeToUpdates(n)};return this.commentAdditionNode.addEventListener("click",(()=>{c()})),this.fieldNode.addEventListener("keyup",(n=>{r&&t(n)&&(0===s.length?c():e.store.dispatch(e.actions.setFocusedComment(s[0].localId,{updatePinnedComment:!0,forceFocus:!0})))})),a}updateVisibility(e){e!==this.shown&&(this.shown=e,this.shown?this.commentAdditionNode.classList.remove("u-hidden"):this.commentAdditionNode.classList.add("u-hidden"))}getAnnotationForComment(){const t=this.annotationTemplateNode.cloneNode(!0);return t.id="",t.setAttribute("aria-label",this.commentAdditionNode.getAttribute("aria-label")),t.setAttribute("aria-describedby",this.commentAdditionNode.getAttribute("aria-describedby")),t.classList.remove("u-hidden"),this.commentAdditionNode.insertAdjacentElement("beforebegin",t),new r(this.fieldNode,t,e)}}function a(t){!function(t){const{selectEnabled:n}=e.selectors,o=()=>n(e.store.getState());let r=o();if(r)return void t();const i=e.store.subscribe((()=>{const e=o();e&&!r&&(r=e,i(),t())}))}((()=>{new s({fieldNode:t.closest("[data-contentpath]"),commentAdditionNode:t,annotationTemplateNode:document.querySelector("#comment-icon")}).register()}))}return{commentApp:e,getContentPath:n,isCommentShortcut:t,initAddCommentButton:a,initCommentsInterface:function(t){const n=document.getElementById("comments"),o=document.getElementById("comments-output"),r=document.getElementById("comments-data");if(!n||!o||!r)throw new Error("Comments app failed to initialise. Missing HTML element");const i=JSON.parse(r.textContent);e.renderApp(n,o,i.user,i.comments,new Map(Object.entries(i.authors))),t.querySelectorAll('[data-component="add-comment-button"]').forEach(a);const s=t.querySelector('[data-tabs] [role="tablist"]');s&&(e.setCurrentTab(s.querySelector('[role="tab"][aria-selected="true"]').getAttribute("href").replace("#","")),s.addEventListener("switch",(t=>{e.setCurrentTab(t.detail.tab)})));const c=document.querySelector('[data-side-panel="comments"]'),l=t.querySelector("[data-comment-notifications]"),m=t.querySelector(".tab-content"),u=t=>{e.setVisible(t),t?(m.classList.add("tab-content--comments-enabled"),l&&(l.hidden=!1)):(m.classList.remove("tab-content--comments-enabled"),l&&(l.hidden=!0))};c&&(c.addEventListener("show",(()=>{u(!0)})),c.addEventListener("hide",(()=>{u(!1)})));const d=document.querySelector('[data-side-panel-toggle="comments"]'),p=document.createElement("div");p.className="-w-mr-3 w-py-0.5 w-px-[0.325rem] w-translate-y-[-8px] rtl:w-translate-x-[4px] w-translate-x-[-4px] w-text-[0.5625rem] w-font-bold w-bg-secondary-100 w-text-white w-border w-border-white w-rounded-[1rem]",d.className="w-h-slim-header w-bg-transparent w-box-border w-py-3 w-px-3 w-flex w-justify-center w-items-center w-outline-offset-inside w-text-grey-400 w-transition hover:w-transform hover:w-scale-110 hover:w-text-primary focus:w-text-primary expanded:w-text-primary",d.appendChild(p);const f=()=>{const t=e.selectors.selectCommentCount(e.store.getState());p&&(t>0?p.innerText=t.toString():p.hidden=!0)};e.store.subscribe(f),f()}}})()}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,n,r,i)=>{if(!n){var s=1/0;for(m=0;m<e.length;m++){for(var[n,r,i]=e[m],a=!0,c=0;c<n.length;c++)(!1&i||s>=i)&&Object.keys(o.O).every((e=>o.O[e](n[c])))?n.splice(c--,1):(a=!1,i<s&&(s=i));if(a){e.splice(m--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var m=e.length;m>0&&e[m-1][2]>i;m--)e[m]=e[m-1];e[m]=[n,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.j=324,(()=>{var e={324:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,i,[s,a,c]=n,l=0;if(s.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(c)var m=c(o)}for(t&&t(n);l<s.length;l++)i=s[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(m)},n=globalThis.webpackChunkwagtail=globalThis.webpackChunkwagtail||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=o.O(void 0,[751],(()=>o(1612)));r=o.O(r)})();
