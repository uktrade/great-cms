{% extends "core/base.html" %}

{% load to_json %}

{% load static from staticfiles %}

{% load great_components %}

{% block css_layout_class %}export-plan-dashboard{% endblock %}

{% block content %}

<section class="export-plan-dashboard__section bg-blue-deep-10">

  <div class="export-plan-dashboard__container container">
    <span class="-section--back-to">

      <a href="{% url 'exportplan:index' %}" class="back-link h-m link body-m-b m-t-xs">
        <i class="fas fa-arrow-circle-left"></i><span class="m-f-xs">Back to My export plans</span>
      </a>
    </span>
    <h2 class="h-m p-t-s">
      Export plan for selling {{ export_plan.export_commodity_codes.0.commodity_name }}
      to {{ export_plan.export_countries.0.country_name }}
    </h2>
    <div id="section-progress">
      <div class="m-t-m">
        <div class="progress-bar progress-bar--white-track">
          <span style="width: {% widthratio export_plan_progress.sections_completed export_plan_progress.sections_total 100 %}%"></span>
        </div>
        <p class="body-m-b m-t-xxs m-b-0">{{ export_plan_progress.sections_completed }} out of {{ export_plan_progress.sections_total }} export plan sections complete</p>
      </div>
    </div>
    <div class="section-list p-v-m" id="section-list">
      <div class="section-list__grid flex-grid" id="export-plan-dashboard">
        {% for section in sections %}
        <div class="c-1-3-xl c-1-2-m">
          <div class="section-list__item bg-white m-b-s">
                 <a class="section-list__link w-1-1 link" href="{{ section.url }}"
              id="{{ section.title|slugify }}">
              <div class="bg-blue-deep-20 section-list__image-container">
                <img class="width-full p-h-s p-t-m p-b-s" src="{% static 'images/ep-placeholder.svg' %}"
                  alt="">
              </div>
              <div class="p-v-s p-h-xs">
                <h3 class="bold body-l-b text-blue-deep-80">{{ section.title }}</h3>
              </div>
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <aside class="export-plan-dashboard__sidebar p-v-m p-r-s p-f-s text-center bg-white">
    {% if not request.user.company.logo %}
    <div class='hidden'>
      <a id="add-image" href="{% url 'exportplan:add-logo' %}"
         class="link text-center text-blue-deep-80 p-t-xs p-b-s section-upload">
        <i class="fas fa-upload"></i>
        <h3 class="m-v-xs bold">Upload your logo</h3>
        <p class="m-0">Click here.</p>
        <p class="m-0">PNG or JPG, 270x170 pixels</p>
      </a>
    </div>
    {% else %}
    <div class="m-b-s">
      <img alt="Your business logo" src="{{ request.user.company.logo }}" class="width-full" />
      <a id="edit-image" href="{% url 'exportplan:add-logo' %}" class="link pencil-link">Update your logo</a>
    </div>
    {% endif %}
    {% with export_plan_id=export_plan.pk %}
    <a class="button button--secondary button--full-width button--icon m-b-xs" href="{{export_plan_download_link}}" title="Save your plan as a PDF">
      <i class="fas fa-download"></i>
      <span class="body-m text-white">Save your plan as a PDF</span>
    </a>
    {% endwith %}
  </aside>
</section>
{% endblock %}
{% block body_js %}
  {{ block.super }}
  <script type="text/javascript">
    magna.createDashboard({
      element: document.getElementById('export-plan-dashboard'),
      sections: {{ sections|to_json}},
      exportPlanProgress: {{ export_plan_progress|to_json }},
    })
  </script>
{% endblock %}
