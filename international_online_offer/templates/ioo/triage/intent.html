{% extends '../base.html' %}
{% load static %}

{% block head_other %}
  <meta
    name="description"
    content="Find information to help invest within the UK"
  />
{% endblock %}

{% block head_css %}
  {{ block.super }}
  <link href="{% static 'directory_components/js/vendor/accessible-autocomplete.min.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}
    <div class="container">
      <main>
        <div class="grid-row">
          <div class="column-two-thirds">
            <a href="{% url 'international_online_offer:sector' %}" class="link-back-new atlas-body">Back</a>
            <span class="atlas-body" style="float: right;">Step 2 of 5</span>
            <br/>
            <br/>
          </div>
        </div>
        <div class="grid-row">
          <div class="column-two-thirds">
            <h3 class="atlas-h--m">How do you plan to expand your business into the UK?</h3>
          </div>
        </div>
        <div class="grid-row">
          <div class="column-two-thirds">
            <form method="post" onsubmit="return onSubmitIntent()">
              {% csrf_token %}
              <div class="">
                <span class="atlas-body form-hint">Choose one or more options from the list</span>
                <br>
                <div id="id_intent_container" style="display: block;">
                  {% include 'core/includes/form_field.html' with field=form.intent %}
                </div>
                <div id="id_intent_other-container" class="inset-text" style="display: block;">
                  <span class='atlas-body'>Type your answer</span>
                  {% include 'core/includes/form_field.html' with field=form.intent_other %}
                </div>
                <br/>
                <button type="submit" class="atlas-button">Continue
                  <span class="atlas-button__icon">
                    <svg viewBox="0 0 13 20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" xmlns:xlink="http://www.w3.org/1999/xlink">
                      <path fill="currentColor" d="M2.893 20l9.834-10L2.893 0 0 2.921 6.976 10 0 17.079z"></path>
                    </svg>
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
          <div class="grid-row">
            <div class="column-two-thirds">
              <br/>
              <div class="atlas-body--s">You can edit this later</div>
            </div>
          </div>
          <div class="grid-row">
            <div class="column-two-thirds">
              <br/>
              <details class="details" data-module="govuk-details">
                <summary class="details__summary">
                  <span class="atlas-body--s" style="color: #006ccc;">
                    <div style="display: inline-block; width: 14px; height: 10px">
                      <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path fill="currentColor" d="M2.893 20l9.834-10L2.893 0 0 2.921 6.976 10 0 17.079z"></path>
                      </svg>
                    </div>
                    &nbsp;Why we ask this question
                  </span>
                </summary>
                <div class="inset-text atlas-body--s">
                  Weâ€™ll use this information to provide customised content relevant to your expansion plans.
                </div>
              </details>
            </div>
        </div>
      </main>
    </div>
{% endblock %}

{% block body_js %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'javascript/dit.components.toggleOther.js' %}"></script>
  <script type="text/javascript">
      var companyTypeOther = document.getElementById('intent-select_5');
      var otherInputs = document.getElementById('id_intent_other-container');
      var companyTypeContainer = document.getElementById('id_intent_container');

      GOVUK.utils.toggleRadioOtherOnClick(companyTypeOther, otherInputs);
      GOVUK.utils.toggleFieldsetClassOnClick(
          [companyTypeContainer],
          companyTypeOther
      );
  </script>
  <script type="text/javascript">
    const checkboxContainer = document.getElementById('intent-select');
    const checkboxElements = checkboxContainer.querySelectorAll('input[type=checkbox]');
    const otherCheckboxElement = document.getElementById('intent-select_5');
    otherCheckboxElement.addEventListener("change", (e) => {
      if (otherCheckboxElement.checked == false) {
        document.getElementById('id_intentOther').value = '';
      }
    })

    function onSubmitIntent() {
      let checkedValues = [];
      for (let i = 0; i < checkboxElements.length; i++) {
        checkboxElements[i].checked && checkedValues.push(document.getElementById('intent-select_' + i).value)
      }
      window.localStorage.setItem('intent', checkedValues);
      window.localStorage.setItem('intentOther', document.getElementById('id_intentOther').value);
    }

    function getIntentIfPreviouslySelected() {
      let previouslySelectedIntent = window.localStorage.getItem('intent') ? window.localStorage.getItem('intent').split(','): [];

      for (let i = 0; i < previouslySelectedIntent.length; i++) {
        for (let o = 0; o < checkboxElements.length; o++) {
          if (previouslySelectedIntent[i] == checkboxElements[o].value) {
            checkboxElements[o].checked = true;
          }
        }
      }
      if (window.localStorage.getItem('intentOther') != null) {
         document.getElementById('id_intentOther').value = window.localStorage.getItem('intentOther');
      }
    }

    getIntentIfPreviouslySelected();
  </script>
{% endblock %}
