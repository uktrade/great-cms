{% extends './base.html' %}
{% load static %}

{% block head_other %}
  <meta
    name="description"
    content="Find information to help invest within the UK"
  />
{% endblock %}

{% block content %}
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-l">Sign in</h1>
          </div>
        </div>
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <h2 class="govuk-body-m">Don't have an account? <a href="{% url 'international_online_offer:signup' %}" class="govuk-link">Sign up</a></h2>
          </div>
        </div>
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <div id="error-summary-container" class="govuk-error-summary" style="display: none;" data-module="govuk-error-summary">
              <div role="alert">
                <div class="govuk-error-summary__body">
                  <ul class="govuk-list govuk-error-summary__list" id="errors-list">
                  </ul>
                </div>
              </div>
            </div>
            {% comment %} <form action="{% url 'sso:business-sso-login-api' %}" method="post"> {% endcomment %}
            <div id="login">
              <label class="govuk-label" for="company_location">Email</label>
              {% include 'core/includes/form_field.html' with field=form.email %}
              <label class="govuk-label" for="company_location">Password</label>
              {% comment %} <div class="govuk-hint">Type to search and choose from the list</div> {% endcomment %}
              {% include 'core/includes/form_field.html' with field=form.password %}
              <p><a class="govuk-link" href="{{ javascript_components.password_reset_url }}">Forgotten password?</a></p>
              <button class="atlas-button" onclick="onSubmitLogin()">Sign in</button>
            </div>
          </div>
        </div>
{% endblock %}

{% block body_js %}
  {{ block.super }}
  <script src="{% static 'javascript/international-online-offer.api.js' %}"></script>
  <script type="text/javascript">
  const onSubmitLogin = () => {
    const data = {
      email: document.getElementById('id_email').value,
      password: document.getElementById('id_password').value
    };
    checkCredentials(data)
      .then((response) => response.json())
      .then((data) => { location.assign('/international/expand-your-business-in-the-uk/guide/') })
      .catch((errors) => {
        handleErrors(errors);
    });
  }

  const handleErrors = (errors) => {
    const errorContainer = document.getElementById('error-summary-container');
    const errorList = document.getElementById('errors-list');
    let errorsClean = [];
    if (Object.hasOwn(errors, '__all__')) {
      errorsClean = errors.__all__;
    } else {
      Object.keys(errors).forEach((errorKey) => {
        errorsClean.push(`${errorKey}: ${errors[errorKey]}`);
      })
    }
    errorContainer.style.display = '';
    errorList.innerHTML = '';
    errorsClean.forEach((error, index) => {
      let li = document.createElement('li');
      li.innerText = error.charAt(0).toUpperCase() + error.substring(1);
      errorList.appendChild(li);
    });
  };
</script>
{% endblock %}
