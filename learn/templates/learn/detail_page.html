{% extends 'core/base.html' %}
{% load wagtailimages_tags %}
{% load routablepageurl from wagtailroutablepage_tags %}
{% load url_map %}
{% load content_tags %}
{% block content %}
    {% load breadcrumbs from component_tags %}
    <div class="great-container">
        {% breadcrumbs page great-breadcrumbs %}
        <a href={{ BREADCRUMBS_ROOT_URL|default:"/" }}>great.gov.uk</a>
        <a href="/learn/categories/">Learn to export</a>
        <a href={{ page.get_parent.get_parent.url }}>{{ page.get_parent.get_parent.title|default:"/" }}</a>
    {% endbreadcrumbs %}
</div>
<div class="great lesson-page govuk-grid-row">
    {% get_category_title_for_lesson page as category_title %}
    <div class="great-container lesson-body govuk-!-padding-top-9">
        <div>
            <div class="govuk-grid-column-two-thirds-from-desktop govuk-!-padding-0">
                <h2 class="govuk-caption-xl">{{ page.get_lesson_category_name }}</h2>
                <h1 class="govuk-heading-xl" id="lesson-title">{{ page.title }}</h1>
                {% if page.hero %}
                    <div class="lesson-hero media-section">{% include 'learn/hero_media_item.html' %}</div>
                {% endif %}
                {% include 'core/objectives.html' %}
                <div class="lesson-body-blocks">{% include 'core/personalised_body.html' %}</div>
            </div>
        </div>
    </div>
</div>
<<<<<<< HEAD
<div class="great great-bg-white">
    <div class="great-container">
        <div class="govuk-grid-column-two-thirds-from-desktop govuk-!-padding-0">
            {% if request.user.is_authenticated %}
                <div class="great-bg-light-blue great-border-top-orange govuk-!-padding-6 ">
                    <div>
                        <div>
                            {% include 'learn/recap.html' %}
                            <hr class="hr hr--light govuk-!-margin-0" />
                        </div>
                    </div>
                    <div class="govuk-!-padding-bottom-2">
                        <fieldset id="mark_as_complete">
                        </fieldset>
=======
<div class="govuk-grid-row great test-knowledge {% if request.user.is_authenticated %}govuk-!-padding-top-8{% endif %}">
    {% if request.user.is_authenticated %}
        <div class="great-container">
            <div class="">
                {% include 'learn/recap.html' %}
                <hr class="hr hr--light govuk-!-margin-0" />
            </div>
        </div>
        <div class="great-container govuk-!-padding-bottom-8">
            <fieldset id="mark_as_complete">
            </fieldset>
        </div>
    {% endif %}
    <div class="great great-container">
        {% if next_lesson %}
            {% include "./return_link.html" with link=backlink title=backlink_title class="only-mobile" %}
            <div class="card card--horizontal">
                <div class="govuk-!-padding-6">
                    <p class="govuk-body great-font-bold govuk-!-margin-0">Your next lesson</p>
                    <h2 class="govuk-heading-l govuk-!-padding-top-2">{{ next_lesson.title }}</h2>
                    {% if next_module %}
                        <p class="govuk-!-margin-top-3 govuk-!-margin-bottom-3">
                            Part of your next module:
                            <br />
                            <strong>{{ next_module.title }}</strong>
                        </p>
                    {% endif %}
                    <a href="{{ next_lesson.get_url }}"
                       class="button primary-button govuk-!-static-margin-top-4">Continue learning</a>
                </div>
                <div class="card__section card__section--image">
                    <div class="card__image great-container">
                        {% comment %}<!--
                  If `next_module` is present, we want to use the image from that ahead of `current_module`
                        -->{% endcomment %}
                        {% with next_module|default:current_module as appropriate_module %}
                            {% image appropriate_module.image original as module_image %}
                            <img src="{{ module_image.url }}" alt="{{ module_image.alt }}" />
                        {% endwith %}
>>>>>>> 31e579e5a (saving changes)
                    </div>
                </div>
            {% endif %}
            {% if next_lesson %}
                <div class="govuk-!-padding-top-6 govuk-!-padding-bottom-8">
                    {% if not next_module %}
                        <h2 class="govuk-heading-m govuk-!-padding-top-2">Next in this topic</h2>
                        <div>
                            <a data-learn-to-export-link="{{ next_lesson.get_url }}"
                               class="great-no-text-decoration great-no-box-shadow great-no-border"
                               href="{{ next_lesson.get_url }}">
                                <div class="great-inline-flex no-wrap great-align-items-center">
                                    <span role="img"
                                          class="fa fa-arrow-right great-text-white great-icon-circular-background govuk-!-margin-right-3"></span>
                                    <span class="govuk-!-margin-0 great-title-link great-card__link great-card__link--heading great-inline govuk-heading-xs great-font-bold">{{ next_lesson.title }}</span>
                                </div>
                            </a>
                        </div>
                    {% endif %}
                    <hr class="great-hr-light govuk-!-margin-top-8 govuk-!-margin-bottom-2" />
                    <h3 class="govuk-heading-s">Explore the topic</h3>
                    <a data-learn-to-export-link="{{ page.get_current_module.url }}"
                       href="{{ page.get_current_module.url }}"
                       class="govuk-link great-font-bold">{{ page.get_current_module.title }}</a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
<<<<<<< HEAD
=======
<div class="govuk-grid-row">
    <div class="govuk-grid-column-one-third govuk-!-padding-0 great-bg-white">
        <div class="great-container">
            {%include 'core/steps.html' with steps=page.get_steps title='Learn to export topics' current_step_url='/learn/categories/getting-started/'%}
        </div>
    </div>
>>>>>>> a8050f534 (saving changes)
</div>
{% include 'learn/promo.html' with bg_class='great-bg-light-blue' %}
{% endblock %}
{% block body_js %}
    {{ block.super }}
    <script>
    {% if request.user.is_authenticated %}
      dataLayer.push({
        event: 'lessonView',
        lessonModule: '{{ current_module }}',
        topicTitle: '{{ page_topic }}',
        lessonTitle: '{{ page.title }}'
      });
      magna.createMarkLessonAsComplete({
        element: document.querySelector("#mark_as_complete"),
        endpoint: '{% url "sso:lesson-completed" lesson=page.id %}'
      })
    {% endif %}

    document.querySelectorAll('.media-section').forEach(element => {
      const transcriptContainer = element.querySelector(".video-transcript-container");

      if (transcriptContainer) {
        magna.createVideoTranscript({
          element: transcriptContainer,
          source: element.querySelector("video source[transcript]")
        })
      }
    })

    </script>
{% endblock %}
