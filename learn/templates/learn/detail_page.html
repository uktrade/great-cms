{% extends 'core/base.html' %}
{% load wagtailimages_tags %}
{% load routablepageurl from wagtailroutablepage_tags %}

{% block content %}
    <div class="container" id="lesson-page">
        <div class="grid">
            <aside class="c-1-6 p-t-xxs p-h-xs">
                <a href="{% url 'core:dashboard' %}">Back</a>
                <ul class="m-v-0">
                    {% for topic in topics %}
                        {% if topic.pk != page.get_parent.pk %}
                        <li class="great-mvp-list-arrow">
                            <h3><a href="{{ topic.get_children.first.get_url }}?{{ request.GET.urlencode }}" class="topic-link">{{ topic.title }}</a></h3>
                        </li>
                        {% else %}
                            <li>
                                <details>
                                    <summary>
                                        <h3 class="h-s">{{ topic.title }}</h3>
                                    </summary>
                                    <ul class="m-v-0">
                                        {% for sibling in page.get_siblings %}
                                            <li><a class="link {% if sibling.pk == page.pk %} bold{% endif %}" href="{{ sibling.get_url }}?{{ request.GET.urlencode }}">{{ sibling.title }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </details>
                            </li>
                        {% endif %}
                    {% endfor %}

                </ul>
            </aside>
            {% include "core/includes/personalisation_bar.html" with profile=request.user.company %}
            <div class="grid p-t-l p-f-l">
                <div class="c-2-3">
                    <h1 class="h-l" id="lesson-title">{{ self.title }}</h1>
                    {% include 'core/personalised_body.html' %}
                    <div id="countries-chooser" class="w-full-viewport"></div>
                    {% with page.get_next_siblings.live.first as next_page %}
                        {% if next_page %}
                            <div class="lesson-next-area p-t-xxl p-b-s">
                                <h5>Next</h5>
                                <a class="lesson-next-link" href="{{ next_page.get_url }}?{{ request.GET.urlencode }}">{{ next_page.title }}</a>
                                <a class="lesson-back-to-learning m-t-l" href="{{ next_page.get_parent.get_url }}">Back to learning</a>
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>
                <div class="c-1-3">
                    <h4 class="h-s">&nbsp;</h4>
                </div>
            </div>

        </div>
    </div>
{% endblock %}
