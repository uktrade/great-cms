{% extends 'domestic/base.html' %}
{% load wagtailimages_tags %}
{% load pagination render_markets_cta from component_tags %}
{% load static %}
{% block head_title %}Markets{% endblock %}
{% block meta_title %}Markets{% endblock %}
{% block css_layout_class %}
    article-list-page
{% endblock css_layout_class %}
{% block content %}
    {% block hero %}
        {% image page.hero_image original as rendition %}
        {% include '_hero.html' with pngImagePath=rendition.url heading="Market Guides" aboveCtaText="Find the answers you need on your target export market, including doing business, tax rates and import regulations. Filter by sector to see the markets best suited to your product or service." classes="great-ds-hero--bg-white"%}
    {% endblock %}
    {% block child_pages %}
        <section id="{{ page.slug }}-list-section"
                 class="topic-list-section markets-landing govuk-!-margin-top-6 govuk-!-padding-bottom-0">
            <div class="container">
                <form novalidate id="sectors-form" action="" method="get">
                    <div class="grid-row">
                        <div class="column-third column-quarter-xl govuk-!-padding-left-2">
                            <div class="filters">
                                <a id="skip-link"
                                   class="accessibility-skip-to-section"
                                   href="#markets-results">Skip filters and go to the market results.</a>
                                <h4 class="margin-top-0 margin-bottom-30 margin-bottom-15-m margin-top-15 govuk-!-padding-left-1"
                                    id="filters-heading">Filter market guides</h4>
                                <span class="verbose">Selecting a filter with Javascript enabled will refresh the page.</span>
                                
                                <ul>
                                    {% for field in markets_filters_form.visible_fields %}
                                    <li class="filter-section {% if forloop.first %}govuk-!-padding-top-0{% endif %}">
                                        {% include '_field.html' with field=field error=field.errors %}
                                    </li>
                                    {% endfor %}
                                </ul>
                                <div class="filters-sticky-footer" id="filters-sticky-footer">
                                    {% include '_button.html' with classes='cancel link' href='#' text='Cancel' %}
                                    {% include '_button.html' with classes='update' href='#' text='Update' %}
                                </div>
                            </div>
                        </div>
                        <div id="markets-results column-three-quarters-xl">
                            <div>
                                {{markets_message|safe}}  
                                {% if has_filters %}
                                    <p class="margin-bottom-45-m">
                                        <a href="{{ request.path }}"
                                            class="view-markets link bold margin-top-15">Clear all filters</a>
                                    </p>
                                {% endif %}
                                <div class="controls margin-bottom-45-m">
                                    {% include '_button.html' with id='mobile-filter-toggle' classes='mobile-filter-toggle' href='#' text='Filter' %}
                                    {% if results_count %}
                                        {% if features.FEATURE_PRODUCT_EXPERIMENT_LINKS %}
                                            <a href="{% url 'core:compare-countries' %}"
                                                class="govuk-link govuk-!-margin-left-6">Find information about your product</a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="flex-grid markets-grid">
                                {% include 'components/card_grid.html' with cards=paginated_results href='' %}
                            </div>
                            <div class="markets-pagination column-two-thirds column-three-quarters-xl">
                                {% pagination pagination_page=paginated_results %}
                            </div>
                        </div>
                    </div>
                    {% include '_button.html' with input=True text='Submit form' type='submit' %}
                </form>
            </div>
            <div class="margin-top-30">{% render_markets_cta %}</div>
        </section>
    {% endblock %}
{% endblock %}
{% block body_js %}
    {{ block.super }}
    <script src="{% static 'javascript/marketFilters.js' %}"></script>
    <script>
  $(function() {
    marketFilters.init();
  });
    </script>
{% endblock %}
