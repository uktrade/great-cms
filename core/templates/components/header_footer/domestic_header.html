{% load static %}
{% load wagtailcore_tags %}
{% load url_map %}

{% if not request.user.is_authenticated %}
  {% include 'components/header_footer/global_header.html' with header_class="domestic" %}
{% endif %}

<header class="magna-header" id="great-domestic-header" dir="ltr" data-ga-section="header">
  <nav class="container">
    <a id="header-logo-link" class="magna-header__logo" href="/">
      <img src="{% static 'images/dit-logo.png' %}" alt="Department for International Trade" id="header-logo-exporting-is-great">
    </a>

    <ul class="magna-header__extra-links">
      {% if request.user.is_authenticated %}
        <li><a href="{% slugurl 'dashboard' %}">Dashboard</a></li>
      {% else %}
        <li><a href="{% url 'core:login' %}">Sign in</a></li>
      {% endif %}
    </ul>

    <div class="magna-header__menu">
      <button type="button" class="magna-header__dropdown-button" data-reveal-button aria-controls="main-menu">
        Menu
        <span class="magna-header__dropdown-button__icon"></span>
      </button>

      <div id="main-menu" class="magna-header__dropdown" role="dialog">
        {% if request.user.is_authenticated %}
        <div class="magna-header__greeting">Hi {{ user.firstname }}</div>
        {% endif %}
        <ul class="magna-header__menu-items">
          {% if request.user.is_authenticated %}
          <li><a href="{% slugurl 'dashboard' %}">Dashboard</a></li>
          <li class="hide-lg">
            <a href="/learn/categories/">Learn to export <span class="tag tag--small">new</span></a>
          </li>
          <li class="hide-lg">
            <a href="{% url "core:compare-countries"%}">Where to export <span class="tag tag--small">new</span></a>
          </li>
          <li class="hide-lg">
            <a href="/export-plan/">Make an export plan <span class="tag tag--small">new</span></a>
          </li>
          {% endif %}

          <li><a href="/advice/">Advice</a></li>
          <li><a href="/markets/">Markets</a></li>
          <li><a href="/services/">Services</a></li>

          {% if request.user.is_authenticated %}
          <li><a href="#">Account</a></li>
          <li>
            <button type="button">Sign out</button>
          </li>
        {% else %}
            <li>
              <a class="button" href="{% url 'core:login' %}">Sign in</a>
            </li>
        {% endif %}
        </ul>
      </div>
      <div class="magna-header__overlay"></div>

      <form id="magna-header-search-form" class="magna-header__search" action="{% url "search:search" %}" method="GET">
        <label for="magna-header-search-box" class="visually-hidden">Search</label>
        <input id="magna-header-search-box" type="text" name="q" placeholder="Search">
        <button>
          <span class="visually-hidden">Search</span>
        </button>
      </form>

      <ul id="services-area" class="magna-header__nav hide-lg_lt">
        {% if request.user.is_authenticated %}
          {% path_match "^\/learn\/" as in_learning %}
          {% path_match "^\/where-to-export\/" as in_targetmarkets %}
          <li><a id="header-link-learning" class="{% if in_learning %}active{% endif %}" href="/learn/categories/">Learn to export</a></li>
          <li><a id="header-link-markets" class="{% if in_targetmarkets %}active{% endif %}" href="{% url "core:compare-countries"%}">Where to export</a></li>
          <li><a id="header-link-exporting-plan" class="{% if in_exportplan %}active{% endif %}" href="/export-plan/">Make an export plan</a></li>
        {% else %}
          <li><a id="header-link-advice" href="/advice/">Advice</a></li>
          <li><a id="header-link-markets-lo" href="/markets/">Markets</a></li>
          <li><a id="header-link-services" href="/services/">Services</a></li>
        {% endif %}
      </ul>
    </div>
  </nav>

</header>
