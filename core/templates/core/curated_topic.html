{% load wagtailcore_tags %}
{% load format_timedelta from content_tags %}
{% load get_lesson_progress_for_topic is_lesson_page is_placeholder_page from content_tags %}

{% comment %} `completed_lessons` only features lessons FOR THIS PARTIAL'S TOPIC {% endcomment %}

<div class="grid" id="{{topic.id}}">

    <div class="learn__topic-item-details c-1-3-l">
        <h2 class="learn__topic-item-title h-m p-b-xxs p-t-0">{{ topic.title }}</h2>
        {% get_lesson_progress_for_topic completed_lessons topic.id as topic_progress_data %}
        {% if topic_progress_data %}
        <p class="m-t-xxs m-b-0 progress-bar-text">
            {{topic_progress_data.lessons_completed}} / {{topic_progress_data.lessons_available}} lesson{{topic_progress_data.lessons_available|pluralize}} completed
        </p>
        {% endif %}
    </div>
    <ul class="learn__lessons-list c-2-3-l">
        {% for page in topic.get_children.live %}
            {% if page|is_lesson_page %}
            <li class="learn__lesson-item">
                <a class="learn__lesson-item-link h-xs" href="{% pageurl page %}" title="{{ page.title }}">
                    <span class="learn__lesson-item-link-text">{{ page.title }}</span>
                    {% if page.id in completed_lessons %}
                    <span class="button quaternary-button button--small learn__lesson-item-link--completed">
                        <i class="fa fa-check"></i>
                        Completed
                    </span>
                    {% else %}
                    <button class="secondary-button">
                       Start a 
                       {{ page.specific.estimated_read_duration|format_timedelta }}
                       lesson
                    </button>
                    {% endif %}
                </a>
            </li>
            {% elif page|is_placeholder_page %}
                {% include "learn/_lesson_placeholder.html" %}
            {% endif %}
        {% endfor %}
    </ul>
</div>
