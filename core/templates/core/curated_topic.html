{% load wagtailcore_tags %}
{% load format_timedelta from content_tags %}
{% load get_lesson_progress_for_topic from content_tags %}

{% comment %} `completed_lessons` only features lessons FOR THIS PARTIAL'S TOPIC {% endcomment %}

<div class="grid" id="{{topic_id}} test_container">

    <div class="learn__topic-item-details c-1-3-l">
        <h2 class="learn__topic-item-title h-m p-b-xxs p-t-0">{{ value.title }}</h2>
        {% get_lesson_progress_for_topic completed_lessons topic_id as topic_progress_data %}
        {% if topic_progress_data %}
        <p class="body-m-b m-t-xxs m-b-0">
            {{topic_progress_data.lessons_completed}} / {{topic_progress_data.lessons_available}} lessons complete
        </p>
        {% endif %}
    </div>
    <ul class="learn__lessons-list c-2-3-l">
        {% for item in value.lessons_and_placeholders %}
            {% if item.block_type == 'lesson' %}
            {% with item.value as page %}
            <li class="learn__lesson-item">
                <a class="learn__lesson-item-link h-xs" href="{% pageurl page %}" title="{{ page.title }}">
                    <span class="learn__lesson-item-link-text">{{ page.title }}</span>
                    {% if page.id in lesson_completion_data %}
                    <span class="button button--quaternary button--small f-r">
                        Completed
                    </span>
                    {% else %}
                    <div class="learn__topic-item-read-time body-l-b">
                        <span class="h-s p-t-0 m-r-xs"><i class="fas fa-clock"></i></span>
                        <span class="f-r">{{ page.specific.estimated_read_duration|format_timedelta }}</span>
                    </div>
                    {% endif %}
                </a>
            </li>
            {% endwith %}
            {% elif item.block_type == 'placeholder'%}
                {% include_block item %}
            {% endif %}
        {% endfor %}
    </ul>
</div>
