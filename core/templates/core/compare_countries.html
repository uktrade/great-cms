{% extends "core/base.html" %}
{% load static %}
{% load wagtailcore_tags %}
{% block head_other %}
    <meta name="description"
          content="Find information to help choose the right export market for your product. Compare data for up to 10 markets, using dynamic feeds from some of the worldâ€™s most trusted sources" />
{% endblock %}
{% block content %}
    <div id="where-to-export">
        <section class="bg-white">
            <div class="page-header where-to-export-header">
                <div class="inner-header">
                    <div>
                        <h1>{{ page.title }}</h1>
                        {% if data_tabs_enabled %}<div id="cta-container"></div>{% endif %}
                    </div>
                    <div class="image-container"></div>
                </div>
            </div>
        </div>
    </section>
</div>
<div class="hidden" id="next-steps">
    {% for component in dashboard_components %}
        {% if component.value.route_type == 'learn' or component.value.route_type == 'plan' %}
            <article class="dashboard__routing-block c-1-2 wide">{% include_block component with wide=True %}</article>
        {% endif %}
    {% endfor %}
</div>
<div id="compare-markets"
     class="container"
     data-tabs="{{ data_tabs_enabled }}"
     data-max-places-allowed="{{ max_compare_places_allowed }}"
     role="region"
     tabindex="-1"></div>
    <section id="hcsat_section"
            class="great-border-thin-top-lighter-blue govuk-!-padding-bottom-6 great-bg-white clearfix govuk-!-margin-top-9 great-hidden">
        <div class="container ">
            {% include './includes/hcsat.html' with hcsat_form=hcsat_form hcsat_stage=hcsat_form_stage%}
        </div>
    </section>
<script>
      magna.CompareMarkets({
        element: document.querySelector("#compare-markets"),
        cta_container: document.querySelector("#cta-container"),
      })
</script>
<script src="{% static 'javascript/govuk.js' %}"></script>
<script>window.GOVUKFrontend.initAll()</script>
    <script src="{% static 'javascript/hcsat-feedback-form.js' %}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        new CsatFormHandler('csat-form');
    });
    var list = document.getElementById("compare-markets");
    var csat_form = document.getElementById("hcsat_section")

    // Checks for table generated by React product/market modal, show hcsat if table has been generated
    var MutationObserver = window.MutationObserver ||
        window.WebKitMutationObserver ||
        window.MozMutationObserver;
    var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            var count = $('#compare-markets tr').length;
            if (count >= 2){
                // if the user has seen a populated table, show hcsat form and stop listening
                csat_form.classList.remove('great-hidden')
                observer.disconnect()
            }
        });
    });
    observer.observe(list, {
        childList: true,
        subtree: true,
    });
    </script>
{% block body_inline_feedback %}
{% endblock %}
{% endblock %}
