{% extends 'great_components/base.html' %}
{% load static %}
{% load static_absolute from great_components %}
{% load url_map %}
{% load to_json %}

{% block head_title %}
  {% if page.title %}
    {{ page.title }}
  {% else %}
    Welcome to great.gov.uk
  {% endif %} - great.gov.uk
{% endblock %}

{% block head_css %}
    <link href="{% static 'magna_styles.css' %}" media="all" rel="stylesheet" />
{% endblock %}

{% block head_js %}
  {{ block.super }}
    <script src="{% static 'common.js' %}"></script>
    <script type="text/javascript" src="{% static 'magna.js' %}"></script>

    <script type="text/javascript">
      // static values that will not be updated by user interacting with react components
      magna.setConfig({
          apiLoginUrl: '{% url "sso:business-sso-login-api" %}',
          apiLogoutUrl: '{% url "sso:business-sso-logout-api" %}',
          apiUserProfileUpdateUrl: '{% url "sso:user-profile-api" %}',
          apiUserQuestionnaireUrl: '{% url "sso:user-questionnaire-api"%}',
          apiUserDataUrl: '{% url "sso:user-data-api" name="-name-" %}',
          apiLookupProductUrl: '{% url "core:api-lookup-product" %}',
          apiLookupProductScheduleUrl: '{% url "core:api-lookup-product-schedule" %}',
          apiCountriesUrl: '{% url "core:api-countries" %}',
          apiSuggestedCountriesUrl: '{% url "core:api-suggested-countries" %}',
          apiCompaniesHouseUrl: '{% url "core:api-companies-house" %}',
          apiSignupUrl: '{% url "sso:business-sso-create-user-api" %}',
          apiUpdateCompanyUrl:  '{% url "core:api-update-company" %}',
          {% if export_plan %}
            apiUpdateExportPlanUrl: '{% url "exportplan:api-update-export-plan" id=export_plan.pk %}',
            apiDeleteExportPlanUrl: '{% url "exportplan:api-export-plan-delete" id=export_plan.pk %}',
            updateCalculateCostAndPricing: '{% url "exportplan:api-calculate-cost-and-pricing" id=export_plan.pk %}',
            apiTargetAgeGroups: '{% url "exportplan:api-target-age-groups" id=export_plan.pk %}',
            exportPlanDashboardUrl: '{% url "exportplan:dashboard" id=export_plan.pk %}',
            exportPlanDownloadUrl: '{{export_plan_download_link}}',
          {% endif %}
          apiModelObjectManageUrl: '{% url "exportplan:api-model-object-manage" %}',
          apiCreateExportPlanUrl: '{% url "exportplan:api-export-plan-create" %}',
          apiComTradeDataUrl: '{% url "core:api-comtrade-data" %}',
          apiCountryDataUrl: '{% url "core:api-country-data" %}',
          societyByCountryUrl: '{% url "exportplan:api-society-data-by-country" %}',
          csrfToken: '{{ csrf_token }}',
          dashboardUrl: '{% url_map "DASHBOARD_URL" %}',
          exportPlanBaseUrl: '{% url "exportplan:index" %}',
          compareCountriesUrl: '{% url "core:compare-countries" %}',
          googleUrl: '{{ javascript_components.google_url }}',
          linkedInUrl: '{{ javascript_components.linkedin_url }}',
          loginUrl: '{% url "core:login" %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}',
          signupUrl: '{% url "core:signup" %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}',
          passwordResetUrl: '{{ javascript_components.password_reset_url }}',
          termsUrl: '{{ javascript_components.terms_url }}',
          user: {
            id: '{{ request.user.id }}',
            name: '{{ request.user.get_username }}',
            isAuthenticated: {{ request.user.is_authenticated|yesno:"true,false" }},
          },
          verifyCodeUrl: '{% url "sso:business-sso-verify-code-api" %}',
          refreshOnMarketChange: {% if refresh_on_market_change %}true{%else%}false{% endif %},
      });
    </script>
{% endblock %}

{% block skip_link %}
  <a id="skip-link" href="#content" tabindex="1">Skip to main content</a>
{% endblock %}

{% block body_header %}
  {% include 'core/header.html' %}

{% endblock %}

{% block body_content_container %}
    {% include "wagtailseo/struct_data.html" %}
  <main id="content" class="{% block css_layout_class %}{% endblock %}">
      {% block content_header %}{% endblock %}
      {% block content %}{% endblock %}
  </main>
{% endblock %}

{% block cookie_notice %}{% endblock %}

{% block body_footer %}
  <div id="snackbar-container"></div>
  {% include 'core/footer.html' %}
{% endblock %}

{% block body_js %}
    {{ block.super }}
    <script type="text/javascript">
      // dynamic value that can be updated by user interacting with react components
      magna.setInitialState({
        // prevents modals from opening on page load if user dismissed the modal already
        performSkipFeatureCookieCheck: true,
        nextUrl: '{% if request.GET.next %}{{ request.GET.next }}{% else %}{% url_map "DASHBOARD_URL" %}{% endif %}',
        modalIsOpen: {
          products: false,
          countries: false,
          industries: false,
          login: false,
          signup: false,
        },
        exportPlan:{
            product: {{export_plan.export_commodity_codes.0|to_json}},
            market: {{export_plan.export_countries.0|to_json }},
            name: '{{export_plan.name|default:'' }}',
        },
      })
      magna.createSnackbar({element:document.getElementById('snackbar-container')})
  </script>
{% endblock %}
