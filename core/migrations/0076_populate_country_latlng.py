# Generated by Fred on 2022-06-09 16:07 ;)
import requests
from django.db import migrations


def populate_latlng(apps, schema_editor):
    """
    This resolves latlng from the API available at restcountries.com
    """
    Country = apps.get_model('core', 'Country')
    all_countries = requests.get("https://restcountries.com/v3.1/all?fields=cca2,latlng")
    if all_countries.status_code == 200:
        all_countries_json = all_countries.json()
        for country in Country.objects.all():
            if country.name:
                found = list(filter(lambda x: x['cca2'] == country.iso2, all_countries_json))
                if len(found) > 0:
                    country.latlng = ','.join(map(str, found[0]['latlng']))
                    country.save()


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0075_country_latlng'),
    ]

    operations = [
        migrations.RunPython(populate_latlng),
    ]
