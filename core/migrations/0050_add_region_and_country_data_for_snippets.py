# Generated by Django 2.2.14 on 2021-01-21 11:07

from django.db import migrations
from django.utils.text import slugify


def forwards_regions(apps, schema_editor):
    Region = apps.get_model('core', 'Region')
    for name in [
        # These came from a DB dump of BAU
        'Antarctica',
        'Australian islands, Indian Ocean',
        'British islands, South Atlantic Ocean',
        'Caribbean',
        'Central America',
        'East Asia',
        'Eastern Europe',
        'French islands, North Atlantic Ocean',
        'Middle East',
        'North Africa',
        'North America',
        'Oceania',
        'Russia',
        'Scandinavia',
        'South America',
        'South Asia',
        'South East Asia',
        'Southern Europe',
        'Sub Saharan Africa',
        'United States islands, Pacific Ocean',
        'West Asia',
        'Western Europe',
    ]:
        Region.objects.get_or_create(name=name)

    region_count = Region.objects.count()
    if region_count != 22:
        raise Exception(f'Wrong number of Regions in the DB - got {region_count} not 22')


def forwards_countries(apps, schema_editor):
    Country = apps.get_model('core', 'Country')
    Region = apps.get_model('core', 'Region')

    data = [
        # using Region names (loaded by the command above) as a natural key
        ('Antarctica', 'Antarctica'),
        ('Christmas Island', 'Australian islands, Indian Ocean'),
        ('Cocos (Keeling) Islands', 'Australian islands, Indian Ocean'),
        ('Ascension', 'British islands, South Atlantic Ocean'),
        ('Falkland Islands', 'British islands, South Atlantic Ocean'),
        ('Saint Helena', 'British islands, South Atlantic Ocean'),
        ('South Georgia and South Sandwich Islands', 'British islands, South Atlantic Ocean'),
        ('Tristan da Cunha', 'British islands, South Atlantic Ocean'),
        ('Anguilla', 'Caribbean'),
        ('Antigua and Barbuda', 'Caribbean'),
        ('Aruba', 'Caribbean'),
        ('Barbados', 'Caribbean'),
        ('Bermuda', 'Caribbean'),
        ('Bonaire', 'Caribbean'),
        ('British Virgin Islands', 'Caribbean'),
        ('Cayman Islands', 'Caribbean'),
        ('Cuba', 'Caribbean'),
        ('Curaçao', 'Caribbean'),
        ('Dominica', 'Caribbean'),
        ('Dominican Republic', 'Caribbean'),
        ('Grenada', 'Caribbean'),
        ('Guadeloupe', 'Caribbean'),
        ('Haiti', 'Caribbean'),
        ('Jamaica', 'Caribbean'),
        ('Martinique', 'Caribbean'),
        ('Montserrat', 'Caribbean'),
        ('Navassa Island', 'Caribbean'),
        ('Pitcairn, Henderson, Ducie and Oeno Islands', 'Caribbean'),
        ('Puerto Rico', 'Caribbean'),
        ('Saba', 'Caribbean'),
        ('Saint Barthélemy', 'Caribbean'),
        ('Saint-Martin (French part)', 'Caribbean'),
        ('Sint Eustatius', 'Caribbean'),
        ('Sint Maarten (Dutch part)', 'Caribbean'),
        ('St Kitts and Nevis', 'Caribbean'),
        ('St Lucia', 'Caribbean'),
        ('St Vincent', 'Caribbean'),
        ('The Bahamas', 'Caribbean'),
        ('Trinidad and Tobago', 'Caribbean'),
        ('Turks and Caicos Islands', 'Caribbean'),
        ('United States Virgin Islands', 'Caribbean'),
        ('Belize', 'Central America'),
        ('Costa Rica', 'Central America'),
        ('El Salvador', 'Central America'),
        ('Guatemala', 'Central America'),
        ('Honduras', 'Central America'),
        ('Mexico', 'Central America'),
        ('Nicaragua', 'Central America'),
        ('Panama', 'Central America'),
        ('China', 'East Asia'),
        ('Hong Kong', 'East Asia'),
        ('Japan', 'East Asia'),
        ('Macao', 'East Asia'),
        ('Mongolia', 'East Asia'),
        ('North Korea', 'East Asia'),
        ('South Korea', 'East Asia'),
        ('Taiwan', 'East Asia'),
        ('Albania', 'Eastern Europe'),
        ('Belarus', 'Eastern Europe'),
        ('Bosnia and Herzegovina', 'Eastern Europe'),
        ('Bulgaria', 'Eastern Europe'),
        ('Croatia', 'Eastern Europe'),
        ('Estonia', 'Eastern Europe'),
        ('Hungary', 'Eastern Europe'),
        ('Kosovo', 'Eastern Europe'),
        ('Latvia', 'Eastern Europe'),
        ('Lithuania', 'Eastern Europe'),
        ('Moldova', 'Eastern Europe'),
        ('Montenegro', 'Eastern Europe'),
        ('North Macedonia', 'Eastern Europe'),
        ('Poland', 'Eastern Europe'),
        ('Romania', 'Eastern Europe'),
        ('Serbia', 'Eastern Europe'),
        ('Slovakia', 'Eastern Europe'),
        ('Turkey', 'Eastern Europe'),
        ('Ukraine', 'Eastern Europe'),
        ('Saint Pierre and Miquelon', 'French islands, North Atlantic Ocean'),
        ('French Polynesia', 'French islands, North Atlantic Ocean'),
        ('Abu Dhabi', 'Middle East'),
        ('Afghanistan', 'Middle East'),
        ('Ajman', 'Middle East'),
        ('Bahrain', 'Middle East'),
        ('Dubai', 'Middle East'),
        ('Fujairah', 'Middle East'),
        ('Iran', 'Middle East'),
        ('Iraq', 'Middle East'),
        ('Israel', 'Middle East'),
        ('Jordan', 'Middle East'),
        ('Kuwait', 'Middle East'),
        ('Lebanon', 'Middle East'),
        ('Occupied Palestinian Territories', 'Middle East'),
        ('Oman', 'Middle East'),
        ('Pakistan', 'Middle East'),
        ('Qatar', 'Middle East'),
        ('Ras al-Khaimah', 'Middle East'),
        ('Saudi Arabia', 'Middle East'),
        ('Sharjah', 'Middle East'),
        ('Syria', 'Middle East'),
        ('Umm al-Quwain', 'Middle East'),
        ('United Arab Emirates', 'Middle East'),
        ('Yemen', 'Middle East'),
        ('Algeria', 'North Africa'),
        ('Ceuta', 'North Africa'),
        ('Egypt', 'North Africa'),
        ('Libya', 'North Africa'),
        ('Melilla', 'North Africa'),
        ('Morocco', 'North Africa'),
        ('Tunisia', 'North Africa'),
        ('Western Sahara', 'North Africa'),
        ('Canada', 'North America'),
        ('Greenland', 'North America'),
        ('United States', 'North America'),
        ('Australia', 'Oceania'),
        ('Cook Islands', 'Oceania'),
        ('Fiji', 'Oceania'),
        ('Kiribati', 'Oceania'),
        ('Marshall Islands', 'Oceania'),
        ('Micronesia', 'Oceania'),
        ('Nauru', 'Oceania'),
        ('New Caledonia', 'Oceania'),
        ('New Zealand', 'Oceania'),
        ('Niue', 'Oceania'),
        ('Norfolk Island', 'Oceania'),
        ('Papua New Guinea', 'Oceania'),
        ('Samoa', 'Oceania'),
        ('Solomon Islands', 'Oceania'),
        ('Tokelau', 'Oceania'),
        ('Tonga', 'Oceania'),
        ('Tuvalu', 'Oceania'),
        ('Vanuatu', 'Oceania'),
        ('Wallis and Futuna', 'Oceania'),
        ('Russia', 'Russia'),
        ('Åland Islands', 'Scandinavia'),
        ('Denmark', 'Scandinavia'),
        ('Faroe Islands', 'Scandinavia'),
        ('Finland', 'Scandinavia'),
        ('Iceland', 'Scandinavia'),
        ('Norway', 'Scandinavia'),
        ('Svalbard and Jan Mayen', 'Scandinavia'),
        ('Sweden', 'Scandinavia'),
        ('Argentina', 'South America'),
        ('Bolivia', 'South America'),
        ('Brazil', 'South America'),
        ('Chile', 'South America'),
        ('Colombia', 'South America'),
        ('Ecuador', 'South America'),
        ('French Guiana', 'South America'),
        ('Guyana', 'South America'),
        ('Paraguay', 'South America'),
        ('Peru', 'South America'),
        ('Suriname', 'South America'),
        ('Uruguay', 'South America'),
        ('Venezuela', 'South America'),
        ('Bangladesh', 'South Asia'),
        ('Bhutan', 'South Asia'),
        ('India', 'South Asia'),
        ('Maldives', 'South Asia'),
        ('Nepal', 'South Asia'),
        ('Sri Lanka', 'South Asia'),
        ('Brunei', 'South East Asia'),
        ('Cambodia', 'South East Asia'),
        ('East Timor', 'South East Asia'),
        ('Indonesia', 'South East Asia'),
        ('Laos', 'South East Asia'),
        ('Malaysia', 'South East Asia'),
        ('Myanmar (Burma)', 'South East Asia'),
        ('Palau', 'South East Asia'),
        ('Philippines', 'South East Asia'),
        ('Singapore', 'South East Asia'),
        ('Thailand', 'South East Asia'),
        ('Vietnam', 'South East Asia'),
        ('Akrotiri', 'Southern Europe'),
        ('Cyprus', 'Southern Europe'),
        ('Dhekelia', 'Southern Europe'),
        ('Gibraltar', 'Southern Europe'),
        ('Greece', 'Southern Europe'),
        ('Italy', 'Southern Europe'),
        ('Malta', 'Southern Europe'),
        ('Monaco', 'Southern Europe'),
        ('Portugal', 'Southern Europe'),
        ('San Marino', 'Southern Europe'),
        ('Slovenia', 'Southern Europe'),
        ('Spain', 'Southern Europe'),
        ('Vatican City', 'Southern Europe'),
        ('Angola', 'Sub Saharan Africa'),
        ('Benin', 'Sub Saharan Africa'),
        ('Botswana', 'Sub Saharan Africa'),
        ('Burkina Faso', 'Sub Saharan Africa'),
        ('Burundi', 'Sub Saharan Africa'),
        ('Cameroon', 'Sub Saharan Africa'),
        ('Cape Verde', 'Sub Saharan Africa'),
        ('Central African Republic', 'Sub Saharan Africa'),
        ('Chad', 'Sub Saharan Africa'),
        ('Comoros', 'Sub Saharan Africa'),
        ('Congo', 'Sub Saharan Africa'),
        ('Congo (Democratic Republic)', 'Sub Saharan Africa'),
        ('Djibouti', 'Sub Saharan Africa'),
        ('Equatorial Guinea', 'Sub Saharan Africa'),
        ('Eritrea', 'Sub Saharan Africa'),
        ('Eswatini', 'Sub Saharan Africa'),
        ('Ethiopia', 'Sub Saharan Africa'),
        ('Gabon', 'Sub Saharan Africa'),
        ('Ghana', 'Sub Saharan Africa'),
        ('Guinea', 'Sub Saharan Africa'),
        ('Guinea-Bissau', 'Sub Saharan Africa'),
        ('Ivory Coast', 'Sub Saharan Africa'),
        ('Kenya', 'Sub Saharan Africa'),
        ('Lesotho', 'Sub Saharan Africa'),
        ('Liberia', 'Sub Saharan Africa'),
        ('Madagascar', 'Sub Saharan Africa'),
        ('Malawi', 'Sub Saharan Africa'),
        ('Mali', 'Sub Saharan Africa'),
        ('Mauritania', 'Sub Saharan Africa'),
        ('Mauritius', 'Sub Saharan Africa'),
        ('Mayotte', 'Sub Saharan Africa'),
        ('Mozambique', 'Sub Saharan Africa'),
        ('Namibia', 'Sub Saharan Africa'),
        ('Niger', 'Sub Saharan Africa'),
        ('Nigeria', 'Sub Saharan Africa'),
        ('Réunion', 'Sub Saharan Africa'),
        ('Rwanda', 'Sub Saharan Africa'),
        ('Sao Tome and Principe', 'Sub Saharan Africa'),
        ('Senegal', 'Sub Saharan Africa'),
        ('Seychelles', 'Sub Saharan Africa'),
        ('Sierra Leone', 'Sub Saharan Africa'),
        ('Somalia', 'Sub Saharan Africa'),
        ('South Africa', 'Sub Saharan Africa'),
        ('South Sudan', 'Sub Saharan Africa'),
        ('Sudan', 'Sub Saharan Africa'),
        ('Tanzania', 'Sub Saharan Africa'),
        ('The Gambia', 'Sub Saharan Africa'),
        ('Togo', 'Sub Saharan Africa'),
        ('Uganda', 'Sub Saharan Africa'),
        ('Zambia', 'Sub Saharan Africa'),
        ('Zimbabwe', 'Sub Saharan Africa'),
        ('American Samoa', 'United States islands, Pacific Ocean'),
        ('Baker Island', 'United States islands, Pacific Ocean'),
        ('Guam', 'United States islands, Pacific Ocean'),
        ('Howland Island', 'United States islands, Pacific Ocean'),
        ('Jarvis Island', 'United States islands, Pacific Ocean'),
        ('Johnston Atoll', 'United States islands, Pacific Ocean'),
        ('Kingman Reef', 'United States islands, Pacific Ocean'),
        ('Midway Islands', 'United States islands, Pacific Ocean'),
        ('Northern Mariana Islands', 'United States islands, Pacific Ocean'),
        ('Palmyra Atoll', 'United States islands, Pacific Ocean'),
        ('Wake Island', 'United States islands, Pacific Ocean'),
        ('Armenia', 'West Asia'),
        ('Azerbaijan', 'West Asia'),
        ('Georgia', 'West Asia'),
        ('Kazakhstan', 'West Asia'),
        ('Kyrgyzstan', 'West Asia'),
        ('Tajikistan', 'West Asia'),
        ('Turkmenistan', 'West Asia'),
        ('Uzbekistan', 'West Asia'),
        ('Andorra', 'Western Europe'),
        ('Austria', 'Western Europe'),
        ('Belgium', 'Western Europe'),
        ('Czechia', 'Western Europe'),
        ('France', 'Western Europe'),
        ('Germany', 'Western Europe'),
        ('Guernsey', 'Western Europe'),
        ('Ireland', 'Western Europe'),
        ('Isle of Man', 'Western Europe'),
        ('Jersey', 'Western Europe'),
        ('Liechtenstein', 'Western Europe'),
        ('Luxembourg', 'Western Europe'),
        ('Netherlands', 'Western Europe'),
        ('Switzerland', 'Western Europe'),
        ('United Kingdom', 'Western Europe'),
    ]

    for country_name, region_name in data:
        try:
            country = Country.objects.get(name=country_name)
            created = False
            # Be sure that countries have slugs set
            if not country.slug:
                country.slug = slugify(country_name)
        except Country.DoesNotExist:
            country = Country.objects.create(name=country_name, slug=slugify(country_name))
            created = True

        if not created:
            print('Updating', end=' ')
        else:
            print('Generating', end=' ')
        print(f'country {country_name} with region {region_name}')

        region = Region.objects.get(name=region_name)
        country.region = region
        country.save()

    country_count = Country.objects.count()
    if country_count != 269:
        raise Exception(f'Wrong number of Countries in the DB - got {region_count} not 269')

    # And a final sense check that all our data is the shape we expect.
    # Will throw Country.DoesNotExist if we have a miss
    for tuple_ in data:
        Country.objects.get(
            name=tuple_[0],
            slug=slugify(tuple_[0]),
            region__name=tuple_[1],
        )


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0049_data_bootstrap_tag_and_industrytag_snippets'),
    ]

    operations = [
        migrations.RunPython(
            forwards_regions,
            migrations.RunPython.noop,
        ),
        migrations.RunPython(
            forwards_countries,
            migrations.RunPython.noop,
        ),
    ]
